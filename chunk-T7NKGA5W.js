import{a as W}from"./chunk-KI4FNWGA.js";import{b as j,c as Y,f as G,i as q,q as z}from"./chunk-HGMB7IMW.js";import{a as F}from"./chunk-ONN25KGN.js";import"./chunk-4DB2YMOA.js";import{f as N}from"./chunk-W32H2YVA.js";import{$ as b,$a as y,Aa as M,Ea as U,Ia as g,Kb as L,Oa as E,Ra as B,Ta as h,Va as A,Vb as D,Wa as O,Wb as K,Xa as a,Ya as o,Z as m,Za as I,Zb as R,_,_a as w,a as V,aa as H,ab as c,b as P,c as T,gb as r,hb as C,ib as x,kb as k,lb as f,mb as v,nb as S,rb as d,sb as l,wa as t}from"./chunk-CW4A2IZA.js";var X=(i,u)=>u.id;function J(i,u){i&1&&(a(0,"div",7),I(1,"div",10)(2,"div",11),o())}function Q(i,u){i&1&&(a(0,"div",8)(1,"h2",12),r(2),d(3,"translate"),o(),a(4,"p",13),r(5),d(6,"translate"),o(),a(7,"a",14),r(8),d(9,"translate"),o()()),i&2&&(t(2),C(l(3,3,"CMS_CHECKOUT.EMPTY_TITLE")),t(3),C(l(6,5,"CMS_CHECKOUT.EMPTY_DESC")),t(3),x(" ",l(9,7,"CMS_CHECKOUT.DISCOVER")," "))}function Z(i,u){if(i&1&&(a(0,"p",43),r(1),o()),i&2){let e=c().$implicit;t(),C(e.addressLine2)}}function $(i,u){i&1&&(a(0,"span",44),r(1,"default"),o())}function ee(i,u){if(i&1){let e=w();a(0,"label")(1,"input",40),S("ngModelChange",function(n){m(e);let s=c(3);return v(s.selectedAddressId,n)||(s.selectedAddressId=n),_(n)}),o(),a(2,"div",41)(3,"p",42),r(4),o(),a(5,"p",43),r(6),o(),g(7,Z,2,1,"p",43),a(8,"p",43),r(9),o()(),g(10,$,2,0,"span",44),o()}if(i&2){let e=u.$implicit,p=c(3);B(p.selectedAddressId===e.id?"flex items-start gap-3 p-4 rounded-xl glass-strong border border-[var(--accent-cyan)] cursor-pointer":"flex items-start gap-3 p-4 rounded-xl glass-subtle border border-white/[0.06] hover:border-white/[0.12] cursor-pointer transition-colors"),t(),E("value",e.id),f("ngModel",p.selectedAddressId),t(3),C(e.recipientName),t(2),C(e.addressLine1),t(),h(e.addressLine2?7:-1),t(2),k("",e.postalCode," ",e.city," ",e.stateProvince,""),t(),h(e.isDefault?10:-1)}}function te(i,u){if(i&1){let e=w();a(0,"div",18),A(1,ee,11,11,"label",38,X),a(3,"button",39),y("click",function(){m(e);let n=c(2);return n.addingNewAddress=!0,_(n.selectedAddressId=null)}),r(4),d(5,"translate"),o()()}if(i&2){let e=c(2);t(),O(e.addresses),t(3),x(" + ",l(5,1,"CMS_CHECKOUT.ADD_NEW_ADDRESS")," ")}}function ie(i,u){i&1&&(a(0,"p",45),r(1),d(2,"translate"),o()),i&2&&(t(),C(l(2,1,"CMS_CHECKOUT.NEW_ADDRESS")))}function ne(i,u){i&1&&(a(0,"p",46),r(1),d(2,"translate"),o()),i&2&&(t(),C(l(2,1,"CMS_CHECKOUT.NO_ADDRESS")))}function oe(i,u){if(i&1){let e=w();a(0,"button",57),y("click",function(){let n;m(e);let s=c(3);return s.addingNewAddress=!1,_(s.selectedAddressId=(n=(n=s.addresses.at(0))==null?null:n.id)!==null&&n!==void 0?n:null)}),r(1),d(2,"translate"),o()}i&2&&(t(),x(" \u2190 ",l(2,1,"CMS_CHECKOUT.USE_EXISTING_ADDRESS")," "))}function ae(i,u){if(i&1){let e=w();a(0,"div",19),g(1,ie,3,3,"p",45)(2,ne,3,3,"p",46),a(3,"div",47)(4,"div",48)(5,"label",49),r(6),d(7,"translate"),o(),a(8,"input",50),d(9,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.recipientName,n)||(s.newAddress.recipientName=n),_(n)}),o()(),a(10,"div",48)(11,"label",49),r(12),d(13,"translate"),o(),a(14,"input",51),d(15,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.addressLine1,n)||(s.newAddress.addressLine1=n),_(n)}),o()(),a(16,"div")(17,"label",49),r(18),d(19,"translate"),o(),a(20,"input",52),d(21,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.city,n)||(s.newAddress.city=n),_(n)}),o()(),a(22,"div")(23,"label",49),r(24),d(25,"translate"),o(),a(26,"input",53),d(27,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.postalCode,n)||(s.newAddress.postalCode=n),_(n)}),o()(),a(28,"div")(29,"label",49),r(30),d(31,"translate"),o(),a(32,"input",54),d(33,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.stateProvince,n)||(s.newAddress.stateProvince=n),_(n)}),o()(),a(34,"div")(35,"label",49),r(36),d(37,"translate"),o(),a(38,"input",55),d(39,"translate"),S("ngModelChange",function(n){m(e);let s=c(2);return v(s.newAddress.countryCode,n)||(s.newAddress.countryCode=n),_(n)}),o()()(),g(40,oe,3,3,"button",56),o()}if(i&2){let e=c(2);t(),h(e.addresses.length>0?1:2),t(5),C(l(7,20,"CMS_CHECKOUT.RECIPIENT")),t(2),f("ngModel",e.newAddress.recipientName),E("placeholder",l(9,22,"CMS_CHECKOUT.RECIPIENT_PLACEHOLDER")),t(4),C(l(13,24,"CMS_CHECKOUT.ADDRESS")),t(2),f("ngModel",e.newAddress.addressLine1),E("placeholder",l(15,26,"CMS_CHECKOUT.ADDRESS_PLACEHOLDER")),t(4),C(l(19,28,"CMS_CHECKOUT.CITY")),t(2),f("ngModel",e.newAddress.city),E("placeholder",l(21,30,"CMS_CHECKOUT.CITY_PLACEHOLDER")),t(4),C(l(25,32,"CMS_CHECKOUT.POSTAL_CODE")),t(2),f("ngModel",e.newAddress.postalCode),E("placeholder",l(27,34,"CMS_CHECKOUT.POSTAL_CODE_PLACEHOLDER")),t(4),C(l(31,36,"CMS_CHECKOUT.PROVINCE")),t(2),f("ngModel",e.newAddress.stateProvince),E("placeholder",l(33,38,"CMS_CHECKOUT.PROVINCE_PLACEHOLDER")),t(4),C(l(37,40,"CMS_CHECKOUT.COUNTRY")),t(2),f("ngModel",e.newAddress.countryCode),E("placeholder",l(39,42,"CMS_CHECKOUT.COUNTRY_PLACEHOLDER")),t(2),h(e.addresses.length>0?40:-1)}}function re(i,u){if(i&1&&(a(0,"p",23),r(1),o()),i&2){let e=c(2);t(),C(e.couponError)}}function de(i,u){if(i&1){let e=w();a(0,"div",24)(1,"span",58),r(2),d(3,"translate"),o(),a(4,"button",59),y("click",function(){m(e);let n=c(2);return _(n.removeCoupon())}),r(5),d(6,"translate"),o()()}if(i&2){let e=c(2);t(2),k(' Coupon "',e.appliedCoupon.code,'" ',l(3,4,"CMS_CHECKOUT.COUPON_APPLIED")," (",e.appliedCoupon.discountType==="percentage"?e.appliedCoupon.discountValue+"%":"\u20AC"+e.appliedCoupon.discountValue,") "),t(3),C(l(6,6,"CMS_CHECKOUT.COUPON_REMOVE"))}}function le(i,u){if(i&1&&(a(0,"span",61),r(1),o()),i&2){let e=c().$implicit;t(),x("(",e.productVariant.name,")")}}function se(i,u){if(i&1&&(a(0,"div",29)(1,"span",60),r(2),d(3,"translate"),g(4,le,2,1,"span",61),r(5),o(),a(6,"span",62),r(7),o()()),i&2){let e=u.$implicit,p=c(2);t(2),x(" ",(e.productVariant==null||e.productVariant.product==null?null:e.productVariant.product.name)||l(3,4,"CMS_CHECKOUT.PRODUCT")," "),t(2),h(e.productVariant!=null&&e.productVariant.name?4:-1),t(),x(" x",e.quantity," "),t(2),x("\u20AC ",(p.getItemPrice(e)*e.quantity).toFixed(2),"")}}function pe(i,u){if(i&1&&(a(0,"div",33)(1,"span"),r(2),d(3,"translate"),o(),a(4,"span"),r(5),o()()),i&2){let e=c(2);t(2),C(l(3,2,"CMS_CHECKOUT.DISCOUNT")),t(3),x("-\u20AC ",e.discount.toFixed(2),"")}}function ce(i,u){i&1&&(a(0,"span",34),r(1),d(2,"translate"),o()),i&2&&(t(),C(l(2,1,"CMS_CHECKOUT.FREE")))}function Ce(i,u){if(i&1&&(a(0,"span",32),r(1),o()),i&2){let e=c(2);t(),x("\u20AC ",e.shippingCost.toFixed(2),"")}}function ue(i,u){if(i&1&&(a(0,"div",36),r(1),o()),i&2){let e=c(2);t(),C(e.error)}}function me(i,u){i&1&&(b(),a(0,"svg",63),I(1,"circle",64)(2,"path",65),o(),r(3),d(4,"translate")),i&2&&(t(3),x(" ",l(4,1,"CMS_CHECKOUT.PROCESSING")," "))}function _e(i,u){i&1&&(r(0),d(1,"translate")),i&2&&x(" ",l(1,1,"CMS_CHECKOUT.PAY_STRIPE")," ")}function xe(i,u){if(i&1){let e=w();a(0,"div",9)(1,"div",15)(2,"div",16)(3,"h2",17),r(4),d(5,"translate"),o(),g(6,te,6,3,"div",18)(7,ae,41,44,"div",19),o(),a(8,"div",16)(9,"h2",17),r(10),d(11,"translate"),o(),a(12,"div",20)(13,"input",21),d(14,"translate"),S("ngModelChange",function(n){m(e);let s=c();return v(s.couponCode,n)||(s.couponCode=n),_(n)}),o(),a(15,"button",22),y("click",function(){m(e);let n=c();return _(n.applyCoupon())}),r(16),d(17,"translate"),o()(),g(18,re,2,1,"p",23)(19,de,7,8,"div",24),o(),a(20,"div",16)(21,"h2",17),r(22),d(23,"translate"),o(),a(24,"textarea",25),d(25,"translate"),S("ngModelChange",function(n){m(e);let s=c();return v(s.customerNotes,n)||(s.customerNotes=n),_(n)}),o()()(),a(26,"div",26)(27,"div",27)(28,"h2",17),r(29),d(30,"translate"),o(),a(31,"div",28),A(32,se,8,6,"div",29,X),o(),a(34,"div",30)(35,"div",31)(36,"span"),r(37),d(38,"translate"),o(),a(39,"span",32),r(40),o()(),g(41,pe,6,4,"div",33),a(42,"div",31)(43,"span"),r(44),d(45,"translate"),o(),g(46,ce,3,3,"span",34)(47,Ce,2,1,"span",32),o(),a(48,"div",35)(49,"span"),r(50),d(51,"translate"),o(),a(52,"span"),r(53),o()()(),g(54,ue,2,1,"div",36),a(55,"button",37),y("click",function(){m(e);let n=c();return _(n.handleCheckout())}),g(56,me,5,3)(57,_e,2,3),o()()()()}if(i&2){let e=c();t(4),C(l(5,23,"CMS_CHECKOUT.SHIPPING_ADDRESS")),t(2),h(e.addresses.length>0&&!e.addingNewAddress?6:7),t(4),C(l(11,25,"CMS_CHECKOUT.COUPON")),t(3),f("ngModel",e.couponCode),E("placeholder",l(14,27,"CMS_CHECKOUT.COUPON_PLACEHOLDER")),t(2),E("disabled",!e.couponCode||e.validatingCoupon),t(),x(" ",l(17,29,"CMS_CHECKOUT.APPLY")," "),t(2),h(e.couponError?18:-1),t(),h(e.appliedCoupon?19:-1),t(3),C(l(23,31,"CMS_CHECKOUT.NOTES")),t(2),f("ngModel",e.customerNotes),E("placeholder",l(25,33,"CMS_CHECKOUT.NOTES_PLACEHOLDER")),t(5),C(l(30,35,"CMS_CHECKOUT.SUMMARY")),t(3),O(e.cart.cartItems),t(5),C(l(38,37,"CMS_CHECKOUT.SUBTOTAL")),t(3),x("\u20AC ",e.subtotal.toFixed(2),""),t(),h(e.discount>0?41:-1),t(3),C(l(45,39,"CMS_CHECKOUT.SHIPPING")),t(2),h(e.subtotal>=50?46:47),t(4),C(l(51,41,"CMS_CHECKOUT.TOTAL")),t(3),x("\u20AC ",e.total.toFixed(2),""),t(),h(e.error?54:-1),t(),E("disabled",e.processing),t(),h(e.processing?56:57)}}var Me=(()=>{class i{api;auth;translate;cart=null;customer=null;addresses=[];selectedAddressId=null;newAddress={recipientName:"",addressLine1:"",city:"",postalCode:"",stateProvince:"",countryCode:"IT"};couponCode="";appliedCoupon=null;couponError=null;validatingCoupon=!1;customerNotes="";loading=!0;processing=!1;error=null;addingNewAddress=!1;constructor(e,p,n){this.api=e,this.auth=p,this.translate=n}ngOnInit(){this.loadData()}getItemPrice(e){let p=e.productVariant?.product,n=p?parseFloat(p.finalPrice):0,s=e.productVariant?parseFloat(e.productVariant.priceAdjustment):0;return n+s}get subtotal(){return this.cart?this.cart.cartItems.reduce((e,p)=>e+this.getItemPrice(p)*p.quantity,0):0}get discount(){return this.appliedCoupon?this.appliedCoupon.discountType==="percentage"?this.subtotal*parseFloat(this.appliedCoupon.discountValue)/100:parseFloat(this.appliedCoupon.discountValue):0}get shippingCost(){return this.subtotal>=50?0:4.99}get total(){return Math.max(0,this.subtotal-this.discount+this.shippingCost)}applyCoupon(){return T(this,null,function*(){if(this.couponCode){this.validatingCoupon=!0,this.couponError=null;try{let e=yield this.api.validateCoupon(this.couponCode);this.appliedCoupon={code:e.code,discountType:e.discountType,discountValue:e.discountValue}}catch{this.couponError=this.translate.instant("CMS_CHECKOUT.COUPON_INVALID")}finally{this.validatingCoupon=!1}}})}removeCoupon(){this.appliedCoupon=null,this.couponCode="",this.couponError=null}handleCheckout(){return T(this,null,function*(){if(!(!this.cart||!this.customer)){this.processing=!0,this.error=null;try{let e=this.selectedAddressId;!e&&this.newAddress.recipientName&&this.newAddress.addressLine1&&(e=(yield this.api.createAddress(this.customer.id,P(V({},this.newAddress),{isShipping:!0,isBilling:!0,isDefault:!0}))).id);let p=this.cart.cartItems.map(s=>({variantId:s.productVariantId,quantity:s.quantity})),n=yield this.api.createCheckout({items:p,shippingAddressId:e||void 0,billingAddressId:e||void 0,couponCode:this.appliedCoupon?.code,customerNotes:this.customerNotes||void 0});n.url&&(window.location.href=n.url)}catch(e){this.error=e instanceof Error?e.message:this.translate.instant("CMS_CHECKOUT.ERROR")}finally{this.processing=!1}}})}loadData(){return T(this,null,function*(){try{this.customer=yield this.auth.getMe(),this.cart=yield this.api.getCart(this.customer.id);try{if(this.addresses=yield this.api.getAddresses(this.customer.id),this.addresses.length>0){let e=this.addresses.find(p=>p.isDefault)||this.addresses[0];this.selectedAddressId=e.id}}catch{this.addresses=[]}}catch{this.cart=null}finally{this.loading=!1}})}static \u0275fac=function(p){return new(p||i)(M(F),M(W),M(D))};static \u0275cmp=U({type:i,selectors:[["app-checkout"]],decls:12,vars:4,consts:[[1,"min-h-screen","pt-28","pb-20",2,"background","var(--bg-primary)"],[1,"container-narrow"],[1,"flex","items-center","gap-3","mb-8"],["routerLink","/cart",1,"text-[var(--text-muted)]","hover:text-white","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-white"],[1,"space-y-6","animate-glow-pulse"],[1,"glass-card","rounded-2xl","p-12","text-center"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"glass-card","rounded-xl","p-6","h-48"],[1,"glass-card","rounded-xl","p-6","h-32"],[1,"text-xl","font-semibold","text-white","mb-2"],[1,"text-[var(--text-secondary)]","mb-6"],["routerLink","/products",1,"btn-primary","inline-block","px-6","py-3","rounded-xl"],[1,"lg:col-span-2","space-y-6"],[1,"glass-card","rounded-xl","p-6"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3"],[1,"space-y-4"],[1,"flex","gap-3"],["type","text","name","coupon",1,"flex-1","input-glass",3,"ngModelChange","ngModel","placeholder"],[1,"btn-secondary","px-5","py-2.5","rounded-xl","font-medium","disabled:opacity-40","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-sm","text-red-400","mt-2"],[1,"mt-3","flex","items-center","justify-between","glass","border","border-emerald-500/20","rounded-xl","px-4","py-2.5"],["name","notes","rows","3",1,"w-full","input-glass","resize-none",3,"ngModelChange","ngModel","placeholder"],[1,"lg:col-span-1"],[1,"glass-card","rounded-xl","p-6","sticky","top-28"],[1,"space-y-3","mb-4"],[1,"flex","justify-between","text-sm"],[1,"border-t","border-white/[0.06]","pt-3","space-y-2","text-sm"],[1,"flex","justify-between","text-[var(--text-secondary)]"],[1,"text-white"],[1,"flex","justify-between","text-emerald-400"],[1,"text-emerald-400","font-medium"],[1,"border-t","border-white/[0.06]","pt-3","flex","justify-between","font-semibold","text-white","text-base"],[1,"mt-4","glass","border","border-red-500/20","text-red-400","px-4","py-3","rounded-xl","text-sm"],[1,"mt-6","w-full","btn-primary","py-4","px-6","rounded-xl","font-semibold","text-base","flex","items-center","justify-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[3,"class"],["type","button",1,"mt-2","w-full","text-sm","text-[var(--accent-cyan)]","hover:text-cyan-300","border","border-[var(--accent-cyan)]/30","hover:border-[var(--accent-cyan)]/60","rounded-xl","py-2.5","transition-colors",3,"click"],["type","radio","name","address",1,"mt-1","w-4","h-4","accent-[var(--accent-cyan)]",3,"ngModelChange","value","ngModel"],[1,"flex-1"],[1,"font-medium","text-white"],[1,"text-sm","text-[var(--text-secondary)]"],[1,"text-xs","text-[var(--accent-cyan)]","border","border-[var(--accent-cyan)]/30","rounded-full","px-2","py-0.5","self-start","mt-0.5"],[1,"text-sm","text-[var(--text-secondary)]","mb-2"],[1,"text-sm","text-[var(--text-secondary)]","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"sm:col-span-2"],[1,"block","text-sm","font-medium","text-[var(--text-secondary)]","mb-1"],["type","text","name","recipientName",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","addressLine1",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","city",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","postalCode",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","stateProvince",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","countryCode",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","button",1,"text-sm","text-[var(--text-muted)]","hover:text-white","transition-colors"],["type","button",1,"text-sm","text-[var(--text-muted)]","hover:text-white","transition-colors",3,"click"],[1,"text-sm","text-emerald-400","font-medium"],[1,"text-emerald-400","hover:text-emerald-300","text-sm","font-medium",3,"click"],[1,"text-[var(--text-secondary)]","truncate","mr-2"],[1,"text-[var(--text-muted)]"],[1,"text-white","font-medium","whitespace-nowrap"],["viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4","fill","none",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(p,n){p&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),b(),a(4,"svg",4),I(5,"path",5),o()(),H(),a(6,"h1",6),r(7),d(8,"translate"),o()(),g(9,J,3,0,"div",7)(10,Q,10,9,"div",8)(11,xe,58,43,"div",9),o()()),p&2&&(t(7),C(l(8,2,"CMS_CHECKOUT.TITLE")),t(2),h(n.loading?9:!n.cart||n.cart.cartItems.length===0?10:11))},dependencies:[L,N,z,j,q,Y,G,R,K],encapsulation:2})}return i})();export{Me as CheckoutComponent};
