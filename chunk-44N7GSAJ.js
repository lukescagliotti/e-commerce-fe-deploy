import{a as $,b as ee,c as te,f as ie,h as ne,j as oe,k as re,l as ae,m as le,n as de,q as se}from"./chunk-HGMB7IMW.js";import{a as Z}from"./chunk-ONN25KGN.js";import"./chunk-4DB2YMOA.js";import{c as Y,e as Q}from"./chunk-W32H2YVA.js";import{$ as F,$a as f,Aa as O,Ea as B,Ia as y,Ib as H,Jb as z,Kb as X,Oa as b,Qa as k,Ta as x,Ua as A,Va as P,Vb as q,Wa as T,Wb as J,Xa as n,Ya as o,Z as u,Za as S,Zb as K,_ as C,_a as E,a as V,aa as R,ab as s,b as D,c as M,fb as W,gb as d,hb as m,ib as v,jb as L,kb as N,lb as g,mb as h,nb as w,pb as G,rb as p,sb as c,ta as U,tb as j,wa as i}from"./chunk-CW4A2IZA.js";var pe=()=>[1,2,3,4,5],I=(r,_)=>_.id,ce=(r,_)=>_.url;function _e(r,_){r&1&&(n(0,"div",8),S(1,"div",9),o())}function me(r,_){if(r&1&&(n(0,"option",18),d(1),o()),r&2){let e=_.$implicit;b("ngValue",e.id),i(),v("\xA0\xA0",e.name,"")}}function ue(r,_){if(r&1&&P(0,me,2,2,"option",18,I),r&2){let e=s().$implicit;T(e.children)}}function Ce(r,_){if(r&1&&(n(0,"option",18),d(1),o(),y(2,ue,2,0)),r&2){let e=_.$implicit;b("ngValue",e.id),i(),m(e.name),i(),x(e.children?2:-1)}}function xe(r,_){r&1&&(n(0,"div",30),S(1,"div",35),o())}function ge(r,_){if(r&1){let e=E();n(0,"div",36),S(1,"img",37),n(2,"div",38)(3,"p",39),d(4),o()(),n(5,"div",40)(6,"label",41),d(7),p(8,"translate"),o(),n(9,"input",42),w("ngModelChange",function(t){let l=u(e).$implicit;return h(l.order,t)||(l.order=t),C(t)}),o()(),n(10,"button",43),f("click",function(){let t=u(e).$index,l=s(3);return C(l.moveImage(t,-1))}),F(),n(11,"svg",44),S(12,"path",45),o()(),R(),n(13,"button",43),f("click",function(){let t=u(e).$index,l=s(3);return C(l.moveImage(t,1))}),F(),n(14,"svg",44),S(15,"path",46),o()(),R(),n(16,"button",47),f("click",function(){let t=u(e).$index,l=s(3);return C(l.removeImage(t))}),F(),n(17,"svg",44),S(18,"path",48),o()()()}if(r&2){let e=_.$implicit,a=_.$index,t=s(3);i(),b("src",e.url,U),i(3),m(e.url.split("/").pop()),i(3),m(c(8,6,"CMS_PRODUCT_FORM.ORDER")),i(2),g("ngModel",e.order),i(),b("disabled",a===0),i(3),b("disabled",a===t.images.length-1)}}function he(r,_){if(r&1&&(n(0,"div",32),P(1,ge,19,8,"div",36,ce),o()),r&2){let e=s(2);i(),T(e.images)}}function we(r,_){r&1&&(n(0,"p",33),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.NO_IMAGES")))}function fe(r,_){if(r&1){let e=E();n(0,"div",52)(1,"div",54)(2,"div")(3,"label",55),d(4),p(5,"translate"),o(),n(6,"input",56),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.code,t)||(l.couponForm.code=t),C(t)}),o()(),n(7,"div")(8,"label",55),d(9),p(10,"translate"),o(),n(11,"select",57),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.discount_type,t)||(l.couponForm.discount_type=t),C(t)}),n(12,"option",58),d(13),p(14,"translate"),o(),n(15,"option",59),d(16),p(17,"translate"),o()()(),n(18,"div")(19,"label",55),d(20),p(21,"translate"),o(),n(22,"input",60),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.discount_value,t)||(l.couponForm.discount_value=t),C(t)}),o()(),n(23,"div")(24,"label",55),d(25),p(26,"translate"),o(),n(27,"input",60),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.min_order_amount,t)||(l.couponForm.min_order_amount=t),C(t)}),o()(),n(28,"div")(29,"label",55),d(30),p(31,"translate"),o(),n(32,"input",61),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.max_uses,t)||(l.couponForm.max_uses=t),C(t)}),o()(),n(33,"div")(34,"label",55),d(35),p(36,"translate"),o(),n(37,"input",62),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.expires_at,t)||(l.couponForm.expires_at=t),C(t)}),o()()(),n(38,"div")(39,"label",55),d(40),p(41,"translate"),o(),n(42,"input",56),w("ngModelChange",function(t){u(e);let l=s(3);return h(l.couponForm.description,t)||(l.couponForm.description=t),C(t)}),o()(),n(43,"button",63),f("click",function(){u(e);let t=s(3);return C(t.saveCoupon())}),d(44),p(45,"translate"),p(46,"translate"),o()()}if(r&2){let e=s(3);i(4),v("",c(5,17,"CMS_PRODUCT_FORM.COUPON_CODE")," *"),i(2),g("ngModel",e.couponForm.code),i(3),v("",c(10,19,"CMS_PRODUCT_FORM.DISCOUNT_TYPE")," *"),i(2),g("ngModel",e.couponForm.discount_type),i(2),m(c(14,21,"CMS_PRODUCT_FORM.PERCENTAGE")),i(3),m(c(17,23,"CMS_PRODUCT_FORM.FIXED")),i(4),v("",c(21,25,"CMS_PRODUCT_FORM.DISCOUNT_VALUE")," *"),i(2),g("ngModel",e.couponForm.discount_value),i(3),m(c(26,27,"CMS_PRODUCT_FORM.MIN_ORDER")),i(2),g("ngModel",e.couponForm.min_order_amount),i(3),m(c(31,29,"CMS_PRODUCT_FORM.MAX_USES")),i(2),g("ngModel",e.couponForm.max_uses),i(3),m(c(36,31,"CMS_PRODUCT_FORM.EXPIRES_AT")),i(2),g("ngModel",e.couponForm.expires_at),i(3),m(c(41,33,"CMS_PRODUCT_FORM.COUPON_DESCRIPTION")),i(2),g("ngModel",e.couponForm.description),i(2),v(" ",e.editingCouponId?c(45,35,"CMS_PRODUCT_FORM.UPDATE_COUPON"):c(46,37,"CMS_PRODUCT_FORM.CREATE_COUPON")," ")}}function ve(r,_){r&1&&(n(0,"span",67),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.INACTIVE")))}function Me(r,_){if(r&1){let e=E();n(0,"div",64)(1,"div",65)(2,"span",66),d(3),o(),n(4,"span",24),d(5),o(),y(6,ve,3,3,"span",67),n(7,"span",41),d(8),p(9,"translate"),o()(),n(10,"div",40)(11,"button",68),f("click",function(){let t=u(e).$implicit,l=s(4);return C(l.editCoupon(t))}),d(12),p(13,"translate"),o(),n(14,"button",69),f("click",function(){let t=u(e).$implicit,l=s(4);return C(l.deleteCoupon(t))}),d(15),p(16,"translate"),o()()()}if(r&2){let e=_.$implicit;i(3),m(e.code),i(2),v(" ",e.discountType==="percentage"?e.discountValue+"%":"\u20AC"+e.discountValue," "),i(),x(e.isActive?-1:6),i(2),N("",e.currentUses||0,"",e.maxUses?"/"+e.maxUses:""," ",c(9,8,"CMS_PRODUCT_FORM.USES"),""),i(4),m(c(13,10,"CMS_PRODUCT_FORM.EDIT")),i(3),m(c(16,12,"CMS_PRODUCT_FORM.DELETE"))}}function Se(r,_){if(r&1&&(n(0,"div",32),P(1,Me,17,14,"div",64,I),o()),r&2){let e=s(3);i(),T(e.coupons)}}function ye(r,_){r&1&&(n(0,"p",33),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.NO_COUPONS")))}function Fe(r,_){if(r&1&&(F(),n(0,"svg",76),S(1,"path",89),o()),r&2){let e=_.$implicit,a=s().$implicit;b("ngClass",e<=a.rating?"text-yellow-400":"text-white/20")}}function be(r,_){if(r&1&&(n(0,"p",78),d(1),o()),r&2){let e=s().$implicit;i(),m(e.title)}}function Ee(r,_){if(r&1&&(n(0,"p",24),d(1),o()),r&2){let e=s().$implicit;i(),m(e.comment)}}function Pe(r,_){r&1&&(n(0,"span",80),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.APPROVED")))}function Te(r,_){r&1&&(n(0,"span",81),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.PENDING")))}function Re(r,_){r&1&&(n(0,"span",82),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.FEATURED_BADGE")))}function Oe(r,_){r&1&&(n(0,"span",83),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.VERIFIED")))}function Ie(r,_){r&1&&(n(0,"span",67),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.HIDDEN")))}function Ve(r,_){if(r&1){let e=E();n(0,"button",90),f("click",function(){u(e);let t=s().$implicit,l=s(4);return C(l.approveReview(t))}),F(),n(1,"svg",44),S(2,"path",91),o()()}}function De(r,_){if(r&1){let e=E();n(0,"button",92),f("click",function(){u(e);let t=s().$implicit,l=s(4);return C(l.hideReview(t))}),F(),n(1,"svg",44),S(2,"path",93),o()()}}function Ue(r,_){if(r&1){let e=E();n(0,"button",94),f("click",function(){u(e);let t=s().$implicit,l=s(4);return C(l.toggleFeatured(t))}),F(),n(1,"svg",95),S(2,"path",89),o()()}if(r&2){let e=s().$implicit;b("title",e.isFeatured?"Rimuovi stella":"Metti in evidenza")("ngClass",e.isFeatured?"text-yellow-400":"text-white/30")}}function Be(r,_){if(r&1){let e=E();n(0,"button",96),f("click",function(){u(e);let t=s().$implicit,l=s(4);return C(l.deleteReview(t))}),F(),n(1,"svg",44),S(2,"path",97),o()()}}function ke(r,_){if(r&1&&(n(0,"div",71)(1,"div",72)(2,"div",73)(3,"div",74)(4,"div",75),P(5,Fe,2,1,":svg:svg",76,A),o(),n(7,"span",77),d(8),o(),n(9,"span",41),d(10),p(11,"date"),o()(),y(12,be,2,1,"p",78)(13,Ee,2,1,"p",24),n(14,"div",79),y(15,Pe,3,3,"span",80)(16,Te,3,3,"span",81)(17,Re,3,3,"span",82)(18,Oe,3,3,"span",83)(19,Ie,3,3,"span",67),o()(),n(20,"div",84),y(21,Ve,3,0,"button",85)(22,De,3,0,"button",86)(23,Ue,3,2,"button",87)(24,Be,3,0,"button",88),o()()()),r&2){let e=_.$implicit;k("opacity-50",e.deletedAt),i(5),T(G(17,pe)),i(3),m((e.customer==null?null:e.customer.fullName)||"Utente #"+e.customerId),i(2),m(j(11,14,e.createdAt,"dd/MM/yyyy")),i(2),x(e.title?12:-1),i(),x(e.comment?13:-1),i(2),x(e.isApproved?15:16),i(2),x(e.isFeatured?17:-1),i(),x(e.isVerifiedPurchase?18:-1),i(),x(e.deletedAt?19:-1),i(2),x(!e.isApproved&&!e.deletedAt?21:-1),i(),x(e.isApproved&&!e.deletedAt?22:-1),i(),x(e.deletedAt?-1:23),i(),x(e.deletedAt?-1:24)}}function Ae(r,_){if(r&1&&(n(0,"div",53),P(1,ke,25,18,"div",70,I),o()),r&2){let e=s(3);i(),T(e.reviews)}}function We(r,_){r&1&&(n(0,"p",33),d(1),p(2,"translate"),o()),r&2&&(i(),m(c(2,1,"CMS_PRODUCT_FORM.NO_REVIEWS")))}function Le(r,_){if(r&1){let e=E();n(0,"div",10)(1,"div",49)(2,"h2",50),d(3),p(4,"translate"),o(),n(5,"button",51),f("click",function(){u(e);let t=s(2);return C(t.showCouponForm=!t.showCouponForm)}),d(6),p(7,"translate"),p(8,"translate"),o()(),y(9,fe,47,39,"div",52)(10,Se,3,0,"div",32)(11,ye,3,3,"p",33),o(),n(12,"div",10)(13,"h2",11),d(14),p(15,"translate"),o(),y(16,Ae,3,0,"div",53)(17,We,3,3,"p",33),o()}if(r&2){let e=s(2);i(3),m(c(4,7,"CMS_PRODUCT_FORM.COUPONS")),i(3),v(" ",e.showCouponForm?c(7,9,"CMS_PRODUCT_FORM.CANCEL"):c(8,11,"CMS_PRODUCT_FORM.NEW_COUPON")," "),i(3),x(e.showCouponForm?9:-1),i(),x(e.coupons.length>0?10:e.showCouponForm?-1:11),i(4),L("",c(15,13,"CMS_PRODUCT_FORM.REVIEWS")," (",e.reviews.length,")"),i(2),x(e.reviews.length>0?16:17)}}function Ne(r,_){if(r&1&&(n(0,"div",34),d(1),o()),r&2){let e=s(2);i(),v(" ",e.errorMessage," ")}}function Ge(r,_){if(r&1){let e=E();n(0,"div",10)(1,"h2",11),d(2),p(3,"translate"),o(),n(4,"div",12)(5,"div")(6,"label",13),d(7),p(8,"translate"),o(),n(9,"input",14),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.name,t)||(l.form.name=t),C(t)}),f("ngModelChange",function(){u(e);let t=s();return C(t.generateSlug())}),o()(),n(10,"div")(11,"label",13),d(12),p(13,"translate"),o(),n(14,"input",14),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.slug,t)||(l.form.slug=t),C(t)}),o()(),n(15,"div",15)(16,"label",13),d(17),p(18,"translate"),o(),n(19,"textarea",16),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.description,t)||(l.form.description=t),C(t)}),o()(),n(20,"div")(21,"label",13),d(22),p(23,"translate"),o(),n(24,"input",14),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.brand,t)||(l.form.brand=t),C(t)}),o()(),n(25,"div")(26,"label",13),d(27),p(28,"translate"),o(),n(29,"select",17),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.category_id,t)||(l.form.category_id=t),C(t)}),n(30,"option",18),d(31),p(32,"translate"),o(),P(33,Ce,3,3,null,null,I),o()(),n(35,"div")(36,"label",13),d(37),p(38,"translate"),o(),n(39,"input",19),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.base_price,t)||(l.form.base_price=t),C(t)}),o()(),n(40,"div")(41,"label",13),d(42),p(43,"translate"),o(),n(44,"input",20),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.discount_percentage,t)||(l.form.discount_percentage=t),C(t)}),o()(),n(45,"div",21)(46,"label",22)(47,"input",23),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.is_active,t)||(l.form.is_active=t),C(t)}),o(),n(48,"span",24),d(49),p(50,"translate"),o()(),n(51,"label",22)(52,"input",23),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.is_featured,t)||(l.form.is_featured=t),C(t)}),o(),n(53,"span",24),d(54),p(55,"translate"),o()()()(),n(56,"h3",25),d(57,"SEO"),o(),n(58,"div",12)(59,"div")(60,"label",13),d(61),p(62,"translate"),o(),n(63,"input",14),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.meta_title,t)||(l.form.meta_title=t),C(t)}),o()(),n(64,"div")(65,"label",13),d(66),p(67,"translate"),o(),n(68,"input",14),w("ngModelChange",function(t){u(e);let l=s();return h(l.form.meta_description,t)||(l.form.meta_description=t),C(t)}),o()()()(),n(69,"div",10)(70,"h2",11),d(71),p(72,"translate"),o(),n(73,"div",26)(74,"div",27),f("click",function(){u(e);let t=W(82);return C(t.click())})("dragover",function(t){return u(e),C(t.preventDefault())})("drop",function(t){u(e);let l=s();return C(l.onDrop(t))}),F(),n(75,"svg",28),S(76,"path",29),o(),R(),n(77,"p",24),d(78),p(79,"translate"),o(),y(80,xe,2,0,"div",30),o(),n(81,"input",31,0),f("change",function(t){u(e);let l=s();return C(l.onFilesSelected(t))}),o()(),y(83,he,3,0,"div",32)(84,we,3,3,"p",33),o(),y(85,Le,18,15)(86,Ne,2,1,"div",34)}if(r&2){let e=s();i(2),m(c(3,31,"CMS_PRODUCT_FORM.PRODUCT_DATA")),i(5),v("",c(8,33,"CMS_PRODUCT_FORM.NAME")," *"),i(2),g("ngModel",e.form.name),i(3),v("",c(13,35,"CMS_PRODUCT_FORM.SLUG")," *"),i(2),g("ngModel",e.form.slug),i(3),m(c(18,37,"CMS_PRODUCT_FORM.DESCRIPTION")),i(2),g("ngModel",e.form.description),i(3),m(c(23,39,"CMS_PRODUCT_FORM.BRAND")),i(2),g("ngModel",e.form.brand),i(3),m(c(28,41,"CMS_PRODUCT_FORM.CATEGORY")),i(2),g("ngModel",e.form.category_id),i(),b("ngValue",null),i(),m(c(32,43,"CMS_PRODUCT_FORM.NO_CATEGORY")),i(2),T(e.categories),i(4),v("",c(38,45,"CMS_PRODUCT_FORM.BASE_PRICE")," *"),i(2),g("ngModel",e.form.base_price),i(3),v("",c(43,47,"CMS_PRODUCT_FORM.DISCOUNT")," (%)"),i(2),g("ngModel",e.form.discount_percentage),i(3),g("ngModel",e.form.is_active),i(2),m(c(50,49,"CMS_PRODUCT_FORM.ACTIVE")),i(3),g("ngModel",e.form.is_featured),i(2),m(c(55,51,"CMS_PRODUCT_FORM.FEATURED")),i(7),m(c(62,53,"CMS_PRODUCT_FORM.META_TITLE")),i(2),g("ngModel",e.form.meta_title),i(3),m(c(67,55,"CMS_PRODUCT_FORM.META_DESCRIPTION")),i(2),g("ngModel",e.form.meta_description),i(3),m(c(72,57,"CMS_PRODUCT_FORM.IMAGES")),i(7),m(c(79,59,"CMS_PRODUCT_FORM.DROP_IMAGES")),i(2),x(e.uploading?80:-1),i(3),x(e.images.length>0?83:84),i(2),x(e.isEdit?85:-1),i(),x(e.errorMessage?86:-1)}}var Ze=(()=>{class r{api;route;router;translate;isEdit=!1;productId=null;loading=!0;saving=!1;uploading=!1;errorMessage="";categories=[];images=[];coupons=[];reviews=[];form={name:"",slug:"",description:"",brand:"",category_id:null,base_price:0,discount_percentage:0,is_active:!0,is_featured:!1,meta_title:"",meta_description:""};showCouponForm=!1;editingCouponId=null;couponForm=this.getEmptyCouponForm();constructor(e,a,t,l){this.api=e,this.route=a,this.router=t,this.translate=l}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&e!=="new"&&(this.isEdit=!0,this.productId=Number(e)),this.loadData()}generateSlug(){(!this.isEdit||!this.form.slug)&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}onFilesSelected(e){return M(this,null,function*(){let a=e.target;a.files&&(yield this.uploadFiles(Array.from(a.files)),a.value="")})}onDrop(e){return M(this,null,function*(){e.preventDefault(),e.dataTransfer?.files&&(yield this.uploadFiles(Array.from(e.dataTransfer.files)))})}uploadFiles(e){return M(this,null,function*(){this.uploading=!0;try{for(let a of e){let t=yield this.api.uploadFile(a,"products");this.images.push({url:t.url,order:this.images.length})}}catch(a){console.error("Upload error:",a),this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.UPLOAD_ERROR")}finally{this.uploading=!1}})}moveImage(e,a){let t=e+a;if(t<0||t>=this.images.length)return;let l=this.images[e];this.images[e]=this.images[t],this.images[t]=l,this.reorderImages()}removeImage(e){this.images.splice(e,1),this.reorderImages()}reorderImages(){this.images.forEach((e,a)=>e.order=a)}getEmptyCouponForm(){return{code:"",description:"",discount_type:"percentage",discount_value:0,min_order_amount:0,max_uses:null,expires_at:""}}editCoupon(e){this.editingCouponId=e.id,this.couponForm={code:e.code,description:e.description||"",discount_type:e.discountType,discount_value:Number(e.discountValue),min_order_amount:e.minOrderAmount?Number(e.minOrderAmount):0,max_uses:e.maxUses,expires_at:e.expiresAt?new Date(e.expiresAt).toISOString().slice(0,16):""},this.showCouponForm=!0}saveCoupon(){return M(this,null,function*(){try{let e=D(V({},this.couponForm),{product_id:this.productId,expires_at:this.couponForm.expires_at||void 0});this.editingCouponId?yield this.api.updateCoupon(this.editingCouponId,e):yield this.api.createCoupon(e),this.showCouponForm=!1,this.editingCouponId=null,this.couponForm=this.getEmptyCouponForm(),yield this.loadCoupons()}catch(e){console.error("Coupon error:",e)}})}deleteCoupon(e){return M(this,null,function*(){if(confirm(this.translate.instant("CMS_PRODUCT_FORM.DELETE_COUPON_CONFIRM")))try{yield this.api.deleteCoupon(e.id),yield this.loadCoupons()}catch(a){console.error("Delete coupon error:",a)}})}approveReview(e){return M(this,null,function*(){try{let a=yield this.api.approveReview(e.id);this.updateReviewInList(a)}catch(a){console.error("Approve error:",a)}})}hideReview(e){return M(this,null,function*(){try{let a=yield this.api.updateReview(e.id,{is_approved:!1});this.updateReviewInList(a)}catch(a){console.error("Hide error:",a)}})}toggleFeatured(e){return M(this,null,function*(){try{let a=yield this.api.toggleReviewFeatured(e.id);this.updateReviewInList(a)}catch(a){console.error("Toggle featured error:",a)}})}deleteReview(e){return M(this,null,function*(){if(confirm(this.translate.instant("CMS_PRODUCT_FORM.DELETE_REVIEW_CONFIRM")))try{let a=yield this.api.deleteReview(e.id);this.updateReviewInList(a)}catch(a){console.error("Delete review error:",a)}})}updateReviewInList(e){let a=this.reviews.findIndex(t=>t.id===e.id);a>=0&&(this.reviews[a]=e)}save(){return M(this,null,function*(){if(!this.form.name||!this.form.slug||!this.form.base_price){this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.REQUIRED_FIELDS");return}this.saving=!0,this.errorMessage="";try{let e=D(V({},this.form),{images:this.images});if(this.isEdit&&this.productId)yield this.api.updateProduct(this.productId,e);else{let a=yield this.api.createProduct(e);this.router.navigate(["/admin/products",a.id]);return}this.errorMessage=""}catch(e){this.errorMessage=e?.error?.message||this.translate.instant("CMS_PRODUCT_FORM.SAVE_ERROR")}finally{this.saving=!1}})}loadData(){return M(this,null,function*(){try{if(this.categories=yield this.api.getCategoryTree(),this.isEdit&&this.productId){let e=yield this.api.getProduct(this.productId);this.form={name:e.name,slug:e.slug,description:e.description||"",brand:e.brand||"",category_id:e.categoryId||null,base_price:Number(e.basePrice),discount_percentage:Number(e.discountPercentage)||0,is_active:e.isActive,is_featured:e.isFeatured,meta_title:e.metaTitle||"",meta_description:e.metaDescription||""},this.images=(e.images||[]).sort((a,t)=>a.order-t.order),yield Promise.all([this.loadCoupons(),this.loadReviews()])}}catch(e){console.error("Load error:",e),this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.LOAD_ERROR")}finally{this.loading=!1}})}loadCoupons(){return M(this,null,function*(){if(this.productId)try{this.coupons=yield this.api.getCouponsByProduct(this.productId)}catch{this.coupons=[]}})}loadReviews(){return M(this,null,function*(){if(this.productId)try{this.reviews=yield this.api.getAdminReviews(this.productId)}catch{this.reviews=[]}})}static \u0275fac=function(a){return new(a||r)(O(Z),O(Y),O(Q),O(q))};static \u0275cmp=B({type:r,selectors:[["app-product-form"]],decls:17,vars:12,consts:[["fileInput",""],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],["routerLink","/admin/products",1,"text-[var(--text-secondary)]","hover:text-white","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-2xl","font-semibold","text-white"],[1,"px-6","py-2.5","rounded-lg","text-sm","font-medium","bg-cyan-500","hover:bg-cyan-400","text-white","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","justify-center","py-12"],[1,"animate-spin","h-8","w-8","border-2","border-cyan-400","border-t-transparent","rounded-full"],[1,"glass-card","rounded-xl","p-6","mb-6"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","text-[var(--text-secondary)]","mb-1"],["type","text",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"md:col-span-2"],["rows","3",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"bg-gray-900",3,"ngValue"],["type","number","step","0.01","min","0",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","max","100",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-6"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","bg-white/[0.06]","border-white/[0.1]","text-cyan-500","focus:ring-cyan-400",3,"ngModelChange","ngModel"],[1,"text-sm","text-[var(--text-secondary)]"],[1,"text-sm","font-medium","text-[var(--text-muted)]","uppercase","tracking-wider","mt-6","mb-3"],[1,"mb-4"],[1,"border-2","border-dashed","border-white/[0.15]","rounded-lg","p-6","text-center","hover:border-cyan-400/50","transition-colors","cursor-pointer",3,"click","dragover","drop"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","mx-auto","mb-2","text-[var(--text-muted)]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"mt-2"],["type","file","accept","image/*","multiple","",1,"hidden",3,"change"],[1,"space-y-2"],[1,"text-sm","text-[var(--text-muted)]","text-center","py-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-4","mb-6","text-red-400","text-sm"],[1,"animate-spin","h-5","w-5","border-2","border-cyan-400","border-t-transparent","rounded-full","mx-auto"],[1,"flex","items-center","gap-3","bg-white/[0.04]","rounded-lg","p-3"],[1,"w-16","h-16","object-cover","rounded-lg",3,"src"],[1,"flex-1","min-w-0"],[1,"text-sm","text-white","truncate"],[1,"flex","items-center","gap-2"],[1,"text-xs","text-[var(--text-muted)]"],["type","number","min","0",1,"w-16","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-2","py-1","text-white","text-sm","text-center","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"p-1","text-[var(--text-secondary)]","hover:text-white","disabled:opacity-30",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 15l7-7 7 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-1","text-red-400","hover:text-red-300",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","bg-white/[0.08]","hover:bg-white/[0.12]","text-[var(--text-secondary)]","hover:text-white","transition-colors",3,"click"],[1,"bg-white/[0.04]","rounded-lg","p-4","mb-4","space-y-3"],[1,"space-y-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"block","text-xs","text-[var(--text-muted)]","mb-1"],["type","text",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["value","percentage",1,"bg-gray-900"],["value","fixed",1,"bg-gray-900"],["type","number","min","0","step","0.01",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","number","min","0",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","datetime-local",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"px-4","py-1.5","rounded-lg","text-sm","font-medium","bg-cyan-500","hover:bg-cyan-400","text-white","transition-colors",3,"click"],[1,"flex","items-center","justify-between","bg-white/[0.04]","rounded-lg","p-3"],[1,"flex","items-center","gap-3"],[1,"px-2","py-0.5","rounded","text-xs","font-mono","font-medium","bg-cyan-500/15","text-cyan-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-red-500/15","text-red-400"],[1,"text-xs","text-[var(--text-secondary)]","hover:text-white","transition-colors",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300","transition-colors",3,"click"],[1,"bg-white/[0.04]","rounded-lg","p-4",3,"opacity-50"],[1,"bg-white/[0.04]","rounded-lg","p-4"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"flex"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4",3,"ngClass"],[1,"text-sm","font-medium","text-white"],[1,"text-sm","font-medium","text-white","mb-0.5"],[1,"flex","items-center","gap-2","mt-2"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-emerald-500/15","text-emerald-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-amber-500/15","text-amber-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-yellow-500/15","text-yellow-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-blue-500/15","text-blue-400"],[1,"flex","items-center","gap-1","ml-4"],["title","Approva",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-emerald-400","transition-colors"],["title","Nascondi",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-amber-400","transition-colors"],[1,"p-1.5","rounded","hover:bg-white/[0.08]","transition-colors",3,"title","ngClass"],["title","Elimina",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-red-400","transition-colors"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"],["title","Approva",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-emerald-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["title","Nascondi",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-amber-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"],[1,"p-1.5","rounded","hover:bg-white/[0.08]","transition-colors",3,"click","title","ngClass"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["title","Elimina",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(a,t){a&1&&(n(0,"div")(1,"div",1)(2,"div",2)(3,"a",3),F(),n(4,"svg",4),S(5,"path",5),o()(),R(),n(6,"div")(7,"h1",6),d(8),p(9,"translate"),p(10,"translate"),o()()(),n(11,"button",7),f("click",function(){return t.save()}),d(12),p(13,"translate"),p(14,"translate"),o()(),y(15,_e,2,0,"div",8)(16,Ge,87,61),o()),a&2&&(i(8),v(" ",t.isEdit?c(9,4,"CMS_PRODUCT_FORM.EDIT_TITLE"):c(10,6,"CMS_PRODUCT_FORM.CREATE_TITLE")," "),i(3),b("disabled",t.saving),i(),v(" ",t.saving?c(13,8,"CMS_PRODUCT_FORM.SAVING"):c(14,10,"CMS_PRODUCT_FORM.SAVE")," "),i(3),x(t.loading?15:16))},dependencies:[X,H,z,se,re,ae,ee,ne,$,oe,te,de,le,ie,K,J],encapsulation:2})}return r})();export{Ze as ProductFormComponent};
