import{a as ie,b as ne,c as oe,f as re,h as ae,j as le,k as de,l as se,m as ce,n as pe,q as _e}from"./chunk-HGMB7IMW.js";import{a as te}from"./chunk-ONN25KGN.js";import"./chunk-4DB2YMOA.js";import{c as J,e as K}from"./chunk-W32H2YVA.js";import{$ as y,$a as v,Aa as V,Ea as W,Ia as F,Ib as Y,Jb as Q,Kb as q,Oa as b,Qa as L,Ta as x,Ua as N,Va as R,Vb as Z,Wa as T,Wb as $,Xa as i,Ya as r,Z as u,Za as f,Zb as ee,_ as C,_a as E,a as D,aa as I,ab as s,b as k,c as S,fb as j,gb as d,hb as m,ib as M,jb as G,kb as H,lb as g,mb as h,nb as w,pb as z,rb as c,sb as p,ta as B,tb as X,wa as n}from"./chunk-CW4A2IZA.js";var me=()=>[1,2,3,4,5],U=(a,_)=>_.id,ue=(a,_)=>_.url;function Ce(a,_){a&1&&(i(0,"div",8),f(1,"div",9),r())}function xe(a,_){if(a&1&&(i(0,"option",18),d(1),r()),a&2){let e=_.$implicit;b("ngValue",e.id),n(),M("\xA0\xA0",e.name,"")}}function ge(a,_){if(a&1&&R(0,xe,2,2,"option",18,U),a&2){let e=s().$implicit;T(e.children)}}function he(a,_){if(a&1&&(i(0,"option",18),d(1),r(),F(2,ge,2,0)),a&2){let e=_.$implicit;b("ngValue",e.id),n(),m(e.name),n(),x(e.children?2:-1)}}function we(a,_){a&1&&(i(0,"div",30),f(1,"div",35),r())}function fe(a,_){if(a&1){let e=E();i(0,"div",36),f(1,"img",37),i(2,"div",38)(3,"p",39),d(4),r()(),i(5,"div",40)(6,"label",41),d(7),c(8,"translate"),r(),i(9,"input",42),w("ngModelChange",function(t){let o=u(e).$implicit;return h(o.order,t)||(o.order=t),C(t)}),r()(),i(10,"button",43),v("click",function(){let t=u(e).$index,o=s(3);return C(o.moveImage(t,-1))}),y(),i(11,"svg",44),f(12,"path",45),r()(),I(),i(13,"button",43),v("click",function(){let t=u(e).$index,o=s(3);return C(o.moveImage(t,1))}),y(),i(14,"svg",44),f(15,"path",46),r()(),I(),i(16,"button",47),v("click",function(){let t=u(e).$index,o=s(3);return C(o.removeImage(t))}),y(),i(17,"svg",44),f(18,"path",48),r()()()}if(a&2){let e=_.$implicit,l=_.$index,t=s(3);n(),b("src",e.url,B),n(3),m(e.url.split("/").pop()),n(3),m(p(8,6,"CMS_PRODUCT_FORM.ORDER")),n(2),g("ngModel",e.order),n(),b("disabled",l===0),n(3),b("disabled",l===t.images.length-1)}}function ve(a,_){if(a&1){let e=E();i(0,"div",36)(1,"div",49),f(2,"img",37),i(3,"div",50),f(4,"div",51),r()(),i(5,"div",38)(6,"p",52),d(7),c(8,"translate"),r()(),i(9,"button",47),v("click",function(){let t=u(e).$implicit,o=s(3);return C(o.removePendingImage(t.id))}),y(),i(10,"svg",44),f(11,"path",48),r()()()}if(a&2){let e=_.$implicit;n(2),b("src",e.previewUrl,B),n(5),m(p(8,2,"CMS_PRODUCT_FORM.CONVERTING"))}}function Me(a,_){if(a&1&&(i(0,"div",32),R(1,fe,19,8,"div",36,ue),R(3,ve,12,4,"div",36,U),r()),a&2){let e=s(2);n(),T(e.images),n(2),T(e.pendingImages)}}function Se(a,_){a&1&&(i(0,"p",33),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.NO_IMAGES")))}function ye(a,_){if(a&1){let e=E();i(0,"div",56)(1,"div",58)(2,"div")(3,"label",59),d(4),c(5,"translate"),r(),i(6,"input",60),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.code,t)||(o.couponForm.code=t),C(t)}),r()(),i(7,"div")(8,"label",59),d(9),c(10,"translate"),r(),i(11,"select",61),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.discount_type,t)||(o.couponForm.discount_type=t),C(t)}),i(12,"option",62),d(13),c(14,"translate"),r(),i(15,"option",63),d(16),c(17,"translate"),r()()(),i(18,"div")(19,"label",59),d(20),c(21,"translate"),r(),i(22,"input",64),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.discount_value,t)||(o.couponForm.discount_value=t),C(t)}),r()(),i(23,"div")(24,"label",59),d(25),c(26,"translate"),r(),i(27,"input",64),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.min_order_amount,t)||(o.couponForm.min_order_amount=t),C(t)}),r()(),i(28,"div")(29,"label",59),d(30),c(31,"translate"),r(),i(32,"input",65),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.max_uses,t)||(o.couponForm.max_uses=t),C(t)}),r()(),i(33,"div")(34,"label",59),d(35),c(36,"translate"),r(),i(37,"input",66),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.expires_at,t)||(o.couponForm.expires_at=t),C(t)}),r()()(),i(38,"div")(39,"label",59),d(40),c(41,"translate"),r(),i(42,"input",60),w("ngModelChange",function(t){u(e);let o=s(3);return h(o.couponForm.description,t)||(o.couponForm.description=t),C(t)}),r()(),i(43,"button",67),v("click",function(){u(e);let t=s(3);return C(t.saveCoupon())}),d(44),c(45,"translate"),c(46,"translate"),r()()}if(a&2){let e=s(3);n(4),M("",p(5,17,"CMS_PRODUCT_FORM.COUPON_CODE")," *"),n(2),g("ngModel",e.couponForm.code),n(3),M("",p(10,19,"CMS_PRODUCT_FORM.DISCOUNT_TYPE")," *"),n(2),g("ngModel",e.couponForm.discount_type),n(2),m(p(14,21,"CMS_PRODUCT_FORM.PERCENTAGE")),n(3),m(p(17,23,"CMS_PRODUCT_FORM.FIXED")),n(4),M("",p(21,25,"CMS_PRODUCT_FORM.DISCOUNT_VALUE")," *"),n(2),g("ngModel",e.couponForm.discount_value),n(3),m(p(26,27,"CMS_PRODUCT_FORM.MIN_ORDER")),n(2),g("ngModel",e.couponForm.min_order_amount),n(3),m(p(31,29,"CMS_PRODUCT_FORM.MAX_USES")),n(2),g("ngModel",e.couponForm.max_uses),n(3),m(p(36,31,"CMS_PRODUCT_FORM.EXPIRES_AT")),n(2),g("ngModel",e.couponForm.expires_at),n(3),m(p(41,33,"CMS_PRODUCT_FORM.COUPON_DESCRIPTION")),n(2),g("ngModel",e.couponForm.description),n(2),M(" ",e.editingCouponId?p(45,35,"CMS_PRODUCT_FORM.UPDATE_COUPON"):p(46,37,"CMS_PRODUCT_FORM.CREATE_COUPON")," ")}}function Fe(a,_){a&1&&(i(0,"span",71),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.INACTIVE")))}function be(a,_){if(a&1){let e=E();i(0,"div",68)(1,"div",69)(2,"span",70),d(3),r(),i(4,"span",24),d(5),r(),F(6,Fe,3,3,"span",71),i(7,"span",41),d(8),c(9,"translate"),r()(),i(10,"div",40)(11,"button",72),v("click",function(){let t=u(e).$implicit,o=s(4);return C(o.editCoupon(t))}),d(12),c(13,"translate"),r(),i(14,"button",73),v("click",function(){let t=u(e).$implicit,o=s(4);return C(o.deleteCoupon(t))}),d(15),c(16,"translate"),r()()()}if(a&2){let e=_.$implicit;n(3),m(e.code),n(2),M(" ",e.discountType==="percentage"?e.discountValue+"%":"\u20AC"+e.discountValue," "),n(),x(e.isActive?-1:6),n(2),H("",e.currentUses||0,"",e.maxUses?"/"+e.maxUses:""," ",p(9,8,"CMS_PRODUCT_FORM.USES"),""),n(4),m(p(13,10,"CMS_PRODUCT_FORM.EDIT")),n(3),m(p(16,12,"CMS_PRODUCT_FORM.DELETE"))}}function Ee(a,_){if(a&1&&(i(0,"div",32),R(1,be,17,14,"div",68,U),r()),a&2){let e=s(3);n(),T(e.coupons)}}function Pe(a,_){a&1&&(i(0,"p",33),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.NO_COUPONS")))}function Re(a,_){if(a&1&&(y(),i(0,"svg",80),f(1,"path",93),r()),a&2){let e=_.$implicit,l=s().$implicit;b("ngClass",e<=l.rating?"text-yellow-400":"text-white/20")}}function Te(a,_){if(a&1&&(i(0,"p",82),d(1),r()),a&2){let e=s().$implicit;n(),m(e.title)}}function Oe(a,_){if(a&1&&(i(0,"p",24),d(1),r()),a&2){let e=s().$implicit;n(),m(e.comment)}}function Ie(a,_){a&1&&(i(0,"span",84),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.APPROVED")))}function Ve(a,_){a&1&&(i(0,"span",85),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.PENDING")))}function Ue(a,_){a&1&&(i(0,"span",86),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.FEATURED_BADGE")))}function De(a,_){a&1&&(i(0,"span",87),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.VERIFIED")))}function ke(a,_){a&1&&(i(0,"span",71),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.HIDDEN")))}function Be(a,_){if(a&1){let e=E();i(0,"button",94),v("click",function(){u(e);let t=s().$implicit,o=s(4);return C(o.approveReview(t))}),y(),i(1,"svg",44),f(2,"path",95),r()()}}function Ae(a,_){if(a&1){let e=E();i(0,"button",96),v("click",function(){u(e);let t=s().$implicit,o=s(4);return C(o.hideReview(t))}),y(),i(1,"svg",44),f(2,"path",97),r()()}}function We(a,_){if(a&1){let e=E();i(0,"button",98),v("click",function(){u(e);let t=s().$implicit,o=s(4);return C(o.toggleFeatured(t))}),y(),i(1,"svg",99),f(2,"path",93),r()()}if(a&2){let e=s().$implicit;b("title",e.isFeatured?"Rimuovi stella":"Metti in evidenza")("ngClass",e.isFeatured?"text-yellow-400":"text-white/30")}}function Le(a,_){if(a&1){let e=E();i(0,"button",100),v("click",function(){u(e);let t=s().$implicit,o=s(4);return C(o.deleteReview(t))}),y(),i(1,"svg",44),f(2,"path",101),r()()}}function Ne(a,_){if(a&1&&(i(0,"div",75)(1,"div",76)(2,"div",77)(3,"div",78)(4,"div",79),R(5,Re,2,1,":svg:svg",80,N),r(),i(7,"span",81),d(8),r(),i(9,"span",41),d(10),c(11,"date"),r()(),F(12,Te,2,1,"p",82)(13,Oe,2,1,"p",24),i(14,"div",83),F(15,Ie,3,3,"span",84)(16,Ve,3,3,"span",85)(17,Ue,3,3,"span",86)(18,De,3,3,"span",87)(19,ke,3,3,"span",71),r()(),i(20,"div",88),F(21,Be,3,0,"button",89)(22,Ae,3,0,"button",90)(23,We,3,2,"button",91)(24,Le,3,0,"button",92),r()()()),a&2){let e=_.$implicit;L("opacity-50",e.deletedAt),n(5),T(z(17,me)),n(3),m((e.customer==null?null:e.customer.fullName)||"Utente #"+e.customerId),n(2),m(X(11,14,e.createdAt,"dd/MM/yyyy")),n(2),x(e.title?12:-1),n(),x(e.comment?13:-1),n(2),x(e.isApproved?15:16),n(2),x(e.isFeatured?17:-1),n(),x(e.isVerifiedPurchase?18:-1),n(),x(e.deletedAt?19:-1),n(2),x(!e.isApproved&&!e.deletedAt?21:-1),n(),x(e.isApproved&&!e.deletedAt?22:-1),n(),x(e.deletedAt?-1:23),n(),x(e.deletedAt?-1:24)}}function je(a,_){if(a&1&&(i(0,"div",57),R(1,Ne,25,18,"div",74,U),r()),a&2){let e=s(3);n(),T(e.reviews)}}function Ge(a,_){a&1&&(i(0,"p",33),d(1),c(2,"translate"),r()),a&2&&(n(),m(p(2,1,"CMS_PRODUCT_FORM.NO_REVIEWS")))}function He(a,_){if(a&1){let e=E();i(0,"div",10)(1,"div",53)(2,"h2",54),d(3),c(4,"translate"),r(),i(5,"button",55),v("click",function(){u(e);let t=s(2);return C(t.showCouponForm=!t.showCouponForm)}),d(6),c(7,"translate"),c(8,"translate"),r()(),F(9,ye,47,39,"div",56)(10,Ee,3,0,"div",32)(11,Pe,3,3,"p",33),r(),i(12,"div",10)(13,"h2",11),d(14),c(15,"translate"),r(),F(16,je,3,0,"div",57)(17,Ge,3,3,"p",33),r()}if(a&2){let e=s(2);n(3),m(p(4,7,"CMS_PRODUCT_FORM.COUPONS")),n(3),M(" ",e.showCouponForm?p(7,9,"CMS_PRODUCT_FORM.CANCEL"):p(8,11,"CMS_PRODUCT_FORM.NEW_COUPON")," "),n(3),x(e.showCouponForm?9:-1),n(),x(e.coupons.length>0?10:e.showCouponForm?-1:11),n(4),G("",p(15,13,"CMS_PRODUCT_FORM.REVIEWS")," (",e.reviews.length,")"),n(2),x(e.reviews.length>0?16:17)}}function ze(a,_){if(a&1&&(i(0,"div",34),d(1),r()),a&2){let e=s(2);n(),M(" ",e.errorMessage," ")}}function Xe(a,_){if(a&1){let e=E();i(0,"div",10)(1,"h2",11),d(2),c(3,"translate"),r(),i(4,"div",12)(5,"div")(6,"label",13),d(7),c(8,"translate"),r(),i(9,"input",14),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.name,t)||(o.form.name=t),C(t)}),v("ngModelChange",function(){u(e);let t=s();return C(t.generateSlug())}),r()(),i(10,"div")(11,"label",13),d(12),c(13,"translate"),r(),i(14,"input",14),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.slug,t)||(o.form.slug=t),C(t)}),r()(),i(15,"div",15)(16,"label",13),d(17),c(18,"translate"),r(),i(19,"textarea",16),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.description,t)||(o.form.description=t),C(t)}),r()(),i(20,"div")(21,"label",13),d(22),c(23,"translate"),r(),i(24,"input",14),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.brand,t)||(o.form.brand=t),C(t)}),r()(),i(25,"div")(26,"label",13),d(27),c(28,"translate"),r(),i(29,"select",17),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.category_id,t)||(o.form.category_id=t),C(t)}),i(30,"option",18),d(31),c(32,"translate"),r(),R(33,he,3,3,null,null,U),r()(),i(35,"div")(36,"label",13),d(37),c(38,"translate"),r(),i(39,"input",19),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.base_price,t)||(o.form.base_price=t),C(t)}),r()(),i(40,"div")(41,"label",13),d(42),c(43,"translate"),r(),i(44,"input",20),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.discount_percentage,t)||(o.form.discount_percentage=t),C(t)}),r()(),i(45,"div",21)(46,"label",22)(47,"input",23),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.is_active,t)||(o.form.is_active=t),C(t)}),r(),i(48,"span",24),d(49),c(50,"translate"),r()(),i(51,"label",22)(52,"input",23),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.is_featured,t)||(o.form.is_featured=t),C(t)}),r(),i(53,"span",24),d(54),c(55,"translate"),r()()()(),i(56,"h3",25),d(57,"SEO"),r(),i(58,"div",12)(59,"div")(60,"label",13),d(61),c(62,"translate"),r(),i(63,"input",14),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.meta_title,t)||(o.form.meta_title=t),C(t)}),r()(),i(64,"div")(65,"label",13),d(66),c(67,"translate"),r(),i(68,"input",14),w("ngModelChange",function(t){u(e);let o=s();return h(o.form.meta_description,t)||(o.form.meta_description=t),C(t)}),r()()()(),i(69,"div",10)(70,"h2",11),d(71),c(72,"translate"),r(),i(73,"div",26)(74,"div",27),v("click",function(){u(e);let t=j(82);return C(t.click())})("dragover",function(t){return u(e),C(t.preventDefault())})("drop",function(t){u(e);let o=s();return C(o.onDrop(t))}),y(),i(75,"svg",28),f(76,"path",29),r(),I(),i(77,"p",24),d(78),c(79,"translate"),r(),F(80,we,2,0,"div",30),r(),i(81,"input",31,0),v("change",function(t){u(e);let o=s();return C(o.onFilesSelected(t))}),r()(),F(83,Me,5,0,"div",32)(84,Se,3,3,"p",33),r(),F(85,He,18,15)(86,ze,2,1,"div",34)}if(a&2){let e=s();n(2),m(p(3,31,"CMS_PRODUCT_FORM.PRODUCT_DATA")),n(5),M("",p(8,33,"CMS_PRODUCT_FORM.NAME")," *"),n(2),g("ngModel",e.form.name),n(3),M("",p(13,35,"CMS_PRODUCT_FORM.SLUG")," *"),n(2),g("ngModel",e.form.slug),n(3),m(p(18,37,"CMS_PRODUCT_FORM.DESCRIPTION")),n(2),g("ngModel",e.form.description),n(3),m(p(23,39,"CMS_PRODUCT_FORM.BRAND")),n(2),g("ngModel",e.form.brand),n(3),m(p(28,41,"CMS_PRODUCT_FORM.CATEGORY")),n(2),g("ngModel",e.form.category_id),n(),b("ngValue",null),n(),m(p(32,43,"CMS_PRODUCT_FORM.NO_CATEGORY")),n(2),T(e.categories),n(4),M("",p(38,45,"CMS_PRODUCT_FORM.BASE_PRICE")," *"),n(2),g("ngModel",e.form.base_price),n(3),M("",p(43,47,"CMS_PRODUCT_FORM.DISCOUNT")," (%)"),n(2),g("ngModel",e.form.discount_percentage),n(3),g("ngModel",e.form.is_active),n(2),m(p(50,49,"CMS_PRODUCT_FORM.ACTIVE")),n(3),g("ngModel",e.form.is_featured),n(2),m(p(55,51,"CMS_PRODUCT_FORM.FEATURED")),n(7),m(p(62,53,"CMS_PRODUCT_FORM.META_TITLE")),n(2),g("ngModel",e.form.meta_title),n(3),m(p(67,55,"CMS_PRODUCT_FORM.META_DESCRIPTION")),n(2),g("ngModel",e.form.meta_description),n(3),m(p(72,57,"CMS_PRODUCT_FORM.IMAGES")),n(7),m(p(79,59,"CMS_PRODUCT_FORM.DROP_IMAGES")),n(2),x(e.pendingImages.length>0?80:-1),n(3),x(e.images.length>0||e.pendingImages.length>0?83:84),n(2),x(e.isEdit?85:-1),n(),x(e.errorMessage?86:-1)}}var nt=(()=>{class a{api;route;router;translate;isEdit=!1;productId=null;loading=!0;saving=!1;errorMessage="";categories=[];images=[];pendingImages=[];coupons=[];reviews=[];form={name:"",slug:"",description:"",brand:"",category_id:null,base_price:0,discount_percentage:0,is_active:!0,is_featured:!1,meta_title:"",meta_description:""};showCouponForm=!1;editingCouponId=null;couponForm=this.getEmptyCouponForm();constructor(e,l,t,o){this.api=e,this.route=l,this.router=t,this.translate=o}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&e!=="new"&&(this.isEdit=!0,this.productId=Number(e)),this.loadData()}generateSlug(){(!this.isEdit||!this.form.slug)&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}onFilesSelected(e){let l=e.target;l.files&&(this.processFiles(Array.from(l.files)),l.value="")}onDrop(e){e.preventDefault(),e.dataTransfer?.files&&this.processFiles(Array.from(e.dataTransfer.files))}processFiles(e){for(let l of e){let t=crypto.randomUUID(),o=URL.createObjectURL(l),P={id:t,previewUrl:o,cancelled:!1};this.pendingImages.push(P),this.processFile(l,P)}}processFile(e,l){return S(this,null,function*(){try{let t;if(e.type==="image/webp")t=e;else{let P=yield this.convertToWebP(e);if(l.cancelled)return;let O=e.name.replace(/\.[^.]+$/,"")+".webp";t=new File([P],O,{type:"image/webp"})}if(l.cancelled)return;let o=yield this.api.uploadFile(t,"products");if(l.cancelled)return;this.images.push({url:o.url,order:this.images.length})}catch(t){console.error("Upload error:",t),l.cancelled||(this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.UPLOAD_ERROR"))}finally{URL.revokeObjectURL(l.previewUrl);let t=this.pendingImages.findIndex(o=>o.id===l.id);t>=0&&this.pendingImages.splice(t,1)}})}convertToWebP(e){return new Promise((l,t)=>{let o=new Image,P=URL.createObjectURL(e);o.onload=()=>{let O=document.createElement("canvas");O.width=o.naturalWidth,O.height=o.naturalHeight,O.getContext("2d").drawImage(o,0,0),URL.revokeObjectURL(P),O.toBlob(A=>A?l(A):t(new Error("WebP conversion failed")),"image/webp",1)},o.onerror=()=>{URL.revokeObjectURL(P),t(new Error("Failed to load image"))},o.src=P})}removePendingImage(e){let l=this.pendingImages.find(t=>t.id===e);if(l){l.cancelled=!0,URL.revokeObjectURL(l.previewUrl);let t=this.pendingImages.findIndex(o=>o.id===e);t>=0&&this.pendingImages.splice(t,1)}}moveImage(e,l){let t=e+l;if(t<0||t>=this.images.length)return;let o=this.images[e];this.images[e]=this.images[t],this.images[t]=o,this.reorderImages()}removeImage(e){this.images.splice(e,1),this.reorderImages()}reorderImages(){this.images.forEach((e,l)=>e.order=l)}getEmptyCouponForm(){return{code:"",description:"",discount_type:"percentage",discount_value:0,min_order_amount:0,max_uses:null,expires_at:""}}editCoupon(e){this.editingCouponId=e.id,this.couponForm={code:e.code,description:e.description||"",discount_type:e.discountType,discount_value:Number(e.discountValue),min_order_amount:e.minOrderAmount?Number(e.minOrderAmount):0,max_uses:e.maxUses,expires_at:e.expiresAt?new Date(e.expiresAt).toISOString().slice(0,16):""},this.showCouponForm=!0}saveCoupon(){return S(this,null,function*(){try{let e=k(D({},this.couponForm),{product_id:this.productId,expires_at:this.couponForm.expires_at||void 0});this.editingCouponId?yield this.api.updateCoupon(this.editingCouponId,e):yield this.api.createCoupon(e),this.showCouponForm=!1,this.editingCouponId=null,this.couponForm=this.getEmptyCouponForm(),yield this.loadCoupons()}catch(e){console.error("Coupon error:",e)}})}deleteCoupon(e){return S(this,null,function*(){if(confirm(this.translate.instant("CMS_PRODUCT_FORM.DELETE_COUPON_CONFIRM")))try{yield this.api.deleteCoupon(e.id),yield this.loadCoupons()}catch(l){console.error("Delete coupon error:",l)}})}approveReview(e){return S(this,null,function*(){try{let l=yield this.api.approveReview(e.id);this.updateReviewInList(l)}catch(l){console.error("Approve error:",l)}})}hideReview(e){return S(this,null,function*(){try{let l=yield this.api.updateReview(e.id,{is_approved:!1});this.updateReviewInList(l)}catch(l){console.error("Hide error:",l)}})}toggleFeatured(e){return S(this,null,function*(){try{let l=yield this.api.toggleReviewFeatured(e.id);this.updateReviewInList(l)}catch(l){console.error("Toggle featured error:",l)}})}deleteReview(e){return S(this,null,function*(){if(confirm(this.translate.instant("CMS_PRODUCT_FORM.DELETE_REVIEW_CONFIRM")))try{let l=yield this.api.deleteReview(e.id);this.updateReviewInList(l)}catch(l){console.error("Delete review error:",l)}})}updateReviewInList(e){let l=this.reviews.findIndex(t=>t.id===e.id);l>=0&&(this.reviews[l]=e)}save(){return S(this,null,function*(){if(!this.form.name||!this.form.slug||!this.form.base_price){this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.REQUIRED_FIELDS");return}this.saving=!0,this.errorMessage="";try{let e=k(D({},this.form),{images:this.images});if(this.isEdit&&this.productId)yield this.api.updateProduct(this.productId,e);else{let l=yield this.api.createProduct(e);this.router.navigate(["/admin/products",l.id]);return}this.errorMessage=""}catch(e){this.errorMessage=e?.error?.message||this.translate.instant("CMS_PRODUCT_FORM.SAVE_ERROR")}finally{this.saving=!1}})}loadData(){return S(this,null,function*(){try{if(this.categories=yield this.api.getCategoryTree(),this.isEdit&&this.productId){let e=yield this.api.getProduct(this.productId);this.form={name:e.name,slug:e.slug,description:e.description||"",brand:e.brand||"",category_id:e.categoryId||null,base_price:Number(e.basePrice),discount_percentage:Number(e.discountPercentage)||0,is_active:e.isActive,is_featured:e.isFeatured,meta_title:e.metaTitle||"",meta_description:e.metaDescription||""},this.images=(e.images||[]).sort((l,t)=>l.order-t.order),yield Promise.all([this.loadCoupons(),this.loadReviews()])}}catch(e){console.error("Load error:",e),this.errorMessage=this.translate.instant("CMS_PRODUCT_FORM.LOAD_ERROR")}finally{this.loading=!1}})}loadCoupons(){return S(this,null,function*(){if(this.productId)try{this.coupons=yield this.api.getCouponsByProduct(this.productId)}catch{this.coupons=[]}})}loadReviews(){return S(this,null,function*(){if(this.productId)try{this.reviews=yield this.api.getAdminReviews(this.productId)}catch{this.reviews=[]}})}static \u0275fac=function(l){return new(l||a)(V(te),V(J),V(K),V(Z))};static \u0275cmp=W({type:a,selectors:[["app-product-form"]],decls:17,vars:12,consts:[["fileInput",""],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],["routerLink","/admin/products",1,"text-[var(--text-secondary)]","hover:text-white","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-2xl","font-semibold","text-white"],[1,"px-6","py-2.5","rounded-lg","text-sm","font-medium","bg-cyan-500","hover:bg-cyan-400","text-white","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex","justify-center","py-12"],[1,"animate-spin","h-8","w-8","border-2","border-cyan-400","border-t-transparent","rounded-full"],[1,"glass-card","rounded-xl","p-6","mb-6"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","text-[var(--text-secondary)]","mb-1"],["type","text",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"md:col-span-2"],["rows","3",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"bg-gray-900",3,"ngValue"],["type","number","step","0.01","min","0",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","max","100",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-3","py-2","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-6"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox",1,"w-4","h-4","rounded","bg-white/[0.06]","border-white/[0.1]","text-cyan-500","focus:ring-cyan-400",3,"ngModelChange","ngModel"],[1,"text-sm","text-[var(--text-secondary)]"],[1,"text-sm","font-medium","text-[var(--text-muted)]","uppercase","tracking-wider","mt-6","mb-3"],[1,"mb-4"],[1,"border-2","border-dashed","border-white/[0.15]","rounded-lg","p-6","text-center","hover:border-cyan-400/50","transition-colors","cursor-pointer",3,"click","dragover","drop"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","mx-auto","mb-2","text-[var(--text-muted)]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"mt-2"],["type","file","accept","image/*","multiple","",1,"hidden",3,"change"],[1,"space-y-2"],[1,"text-sm","text-[var(--text-muted)]","text-center","py-4"],[1,"bg-red-500/10","border","border-red-500/20","rounded-lg","p-4","mb-6","text-red-400","text-sm"],[1,"animate-spin","h-5","w-5","border-2","border-cyan-400","border-t-transparent","rounded-full","mx-auto"],[1,"flex","items-center","gap-3","bg-white/[0.04]","rounded-lg","p-3"],[1,"w-16","h-16","object-cover","rounded-lg",3,"src"],[1,"flex-1","min-w-0"],[1,"text-sm","text-white","truncate"],[1,"flex","items-center","gap-2"],[1,"text-xs","text-[var(--text-muted)]"],["type","number","min","0",1,"w-16","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-2","py-1","text-white","text-sm","text-center","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"p-1","text-[var(--text-secondary)]","hover:text-white","disabled:opacity-30",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 15l7-7 7 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-1","text-red-400","hover:text-red-300",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"relative","w-16","h-16","flex-shrink-0"],[1,"absolute","inset-0","bg-black/50","rounded-lg","flex","items-center","justify-center"],[1,"animate-spin","h-5","w-5","border-2","border-cyan-400","border-t-transparent","rounded-full"],[1,"text-sm","text-[var(--text-secondary)]","truncate"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-white"],[1,"px-3","py-1.5","rounded-lg","text-xs","font-medium","bg-white/[0.08]","hover:bg-white/[0.12]","text-[var(--text-secondary)]","hover:text-white","transition-colors",3,"click"],[1,"bg-white/[0.04]","rounded-lg","p-4","mb-4","space-y-3"],[1,"space-y-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"block","text-xs","text-[var(--text-muted)]","mb-1"],["type","text",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["value","percentage",1,"bg-gray-900"],["value","fixed",1,"bg-gray-900"],["type","number","min","0","step","0.01",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","number","min","0",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],["type","datetime-local",1,"w-full","bg-white/[0.06]","border","border-white/[0.1]","rounded","px-3","py-1.5","text-white","text-sm","focus:outline-none","focus:border-cyan-400",3,"ngModelChange","ngModel"],[1,"px-4","py-1.5","rounded-lg","text-sm","font-medium","bg-cyan-500","hover:bg-cyan-400","text-white","transition-colors",3,"click"],[1,"flex","items-center","justify-between","bg-white/[0.04]","rounded-lg","p-3"],[1,"flex","items-center","gap-3"],[1,"px-2","py-0.5","rounded","text-xs","font-mono","font-medium","bg-cyan-500/15","text-cyan-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-red-500/15","text-red-400"],[1,"text-xs","text-[var(--text-secondary)]","hover:text-white","transition-colors",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300","transition-colors",3,"click"],[1,"bg-white/[0.04]","rounded-lg","p-4",3,"opacity-50"],[1,"bg-white/[0.04]","rounded-lg","p-4"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"flex"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4",3,"ngClass"],[1,"text-sm","font-medium","text-white"],[1,"text-sm","font-medium","text-white","mb-0.5"],[1,"flex","items-center","gap-2","mt-2"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-emerald-500/15","text-emerald-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-amber-500/15","text-amber-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-yellow-500/15","text-yellow-400"],[1,"px-1.5","py-0.5","rounded","text-xs","bg-blue-500/15","text-blue-400"],[1,"flex","items-center","gap-1","ml-4"],["title","Approva",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-emerald-400","transition-colors"],["title","Nascondi",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-amber-400","transition-colors"],[1,"p-1.5","rounded","hover:bg-white/[0.08]","transition-colors",3,"title","ngClass"],["title","Elimina",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-red-400","transition-colors"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"],["title","Approva",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-emerald-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["title","Nascondi",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-amber-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"],[1,"p-1.5","rounded","hover:bg-white/[0.08]","transition-colors",3,"click","title","ngClass"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["title","Elimina",1,"p-1.5","rounded","hover:bg-white/[0.08]","text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(l,t){l&1&&(i(0,"div")(1,"div",1)(2,"div",2)(3,"a",3),y(),i(4,"svg",4),f(5,"path",5),r()(),I(),i(6,"div")(7,"h1",6),d(8),c(9,"translate"),c(10,"translate"),r()()(),i(11,"button",7),v("click",function(){return t.save()}),d(12),c(13,"translate"),c(14,"translate"),r()(),F(15,Ce,2,0,"div",8)(16,Xe,87,61),r()),l&2&&(n(8),M(" ",t.isEdit?p(9,4,"CMS_PRODUCT_FORM.EDIT_TITLE"):p(10,6,"CMS_PRODUCT_FORM.CREATE_TITLE")," "),n(3),b("disabled",t.saving||t.pendingImages.length>0),n(),M(" ",t.saving?p(13,8,"CMS_PRODUCT_FORM.SAVING"):p(14,10,"CMS_PRODUCT_FORM.SAVE")," "),n(3),x(t.loading?15:16))},dependencies:[q,Y,Q,_e,de,se,ne,ae,ie,le,oe,pe,ce,re,ee,$],encapsulation:2})}return a})();export{nt as ProductFormComponent};
