import{a as W}from"./chunk-VUVGIWZW.js";import{b as j,c as Y,f as q,i as G,q as z}from"./chunk-HGMB7IMW.js";import{a as F}from"./chunk-ONN25KGN.js";import"./chunk-4DB2YMOA.js";import{f as K}from"./chunk-W32H2YVA.js";import{$ as O,$a as I,Aa as T,Ea as B,Ia as E,Kb as U,Oa as h,Ra as L,Ta as g,Va as b,Vb as N,Wa as A,Wb as D,Xa as a,Ya as i,Z as m,Za as M,Zb as R,_,_a as w,a as P,aa as H,ab as C,b as V,c as y,gb as r,hb as c,ib as x,kb as k,lb as f,mb as v,nb as S,rb as l,sb as p,wa as t}from"./chunk-CW4A2IZA.js";var J=(n,u)=>u.id;function Q(n,u){n&1&&(a(0,"div",7),M(1,"div",10)(2,"div",11),i())}function X(n,u){n&1&&(a(0,"div",8)(1,"h2",12),r(2),l(3,"translate"),i(),a(4,"p",13),r(5),l(6,"translate"),i(),a(7,"a",14),r(8),l(9,"translate"),i()()),n&2&&(t(2),c(p(3,3,"CMS_CHECKOUT.EMPTY_TITLE")),t(3),c(p(6,5,"CMS_CHECKOUT.EMPTY_DESC")),t(3),x(" ",p(9,7,"CMS_CHECKOUT.DISCOVER")," "))}function Z(n,u){if(n&1&&(a(0,"p",41),r(1),i()),n&2){let e=C().$implicit;t(),c(e.addressLine2)}}function $(n,u){if(n&1){let e=w();a(0,"label")(1,"input",39),S("ngModelChange",function(o){m(e);let s=C(3);return v(s.selectedAddressId,o)||(s.selectedAddressId=o),_(o)}),i(),a(2,"div")(3,"p",40),r(4),i(),a(5,"p",41),r(6),i(),E(7,Z,2,1,"p",41),a(8,"p",41),r(9),i()()()}if(n&2){let e=u.$implicit,d=C(3);L(d.selectedAddressId===e.id?"flex items-start gap-3 p-4 rounded-xl glass-strong border border-[var(--accent-cyan)] cursor-pointer":"flex items-start gap-3 p-4 rounded-xl glass-subtle border border-white/[0.06] hover:border-white/[0.12] cursor-pointer transition-colors"),t(),h("value",e.id),f("ngModel",d.selectedAddressId),t(3),c(e.recipientName),t(2),c(e.addressLine1),t(),g(e.addressLine2?7:-1),t(2),k("",e.postalCode," ",e.city," ",e.stateProvince,"")}}function ee(n,u){if(n&1&&(a(0,"div",18),b(1,$,10,10,"label",38,J),i()),n&2){let e=C(2);t(),A(e.addresses)}}function te(n,u){if(n&1){let e=w();a(0,"div",19)(1,"p",42),r(2),l(3,"translate"),i(),a(4,"div",43)(5,"div",44)(6,"label",45),r(7),l(8,"translate"),i(),a(9,"input",46),l(10,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.recipientName,o)||(s.newAddress.recipientName=o),_(o)}),i()(),a(11,"div",44)(12,"label",45),r(13),l(14,"translate"),i(),a(15,"input",47),l(16,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.addressLine1,o)||(s.newAddress.addressLine1=o),_(o)}),i()(),a(17,"div")(18,"label",45),r(19),l(20,"translate"),i(),a(21,"input",48),l(22,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.city,o)||(s.newAddress.city=o),_(o)}),i()(),a(23,"div")(24,"label",45),r(25),l(26,"translate"),i(),a(27,"input",49),l(28,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.postalCode,o)||(s.newAddress.postalCode=o),_(o)}),i()(),a(29,"div")(30,"label",45),r(31),l(32,"translate"),i(),a(33,"input",50),l(34,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.stateProvince,o)||(s.newAddress.stateProvince=o),_(o)}),i()(),a(35,"div")(36,"label",45),r(37),l(38,"translate"),i(),a(39,"input",51),l(40,"translate"),S("ngModelChange",function(o){m(e);let s=C(2);return v(s.newAddress.countryCode,o)||(s.newAddress.countryCode=o),_(o)}),i()()()()}if(n&2){let e=C(2);t(2),c(p(3,19,"CMS_CHECKOUT.NO_ADDRESS")),t(5),c(p(8,21,"CMS_CHECKOUT.RECIPIENT")),t(2),f("ngModel",e.newAddress.recipientName),h("placeholder",p(10,23,"CMS_CHECKOUT.RECIPIENT_PLACEHOLDER")),t(4),c(p(14,25,"CMS_CHECKOUT.ADDRESS")),t(2),f("ngModel",e.newAddress.addressLine1),h("placeholder",p(16,27,"CMS_CHECKOUT.ADDRESS_PLACEHOLDER")),t(4),c(p(20,29,"CMS_CHECKOUT.CITY")),t(2),f("ngModel",e.newAddress.city),h("placeholder",p(22,31,"CMS_CHECKOUT.CITY_PLACEHOLDER")),t(4),c(p(26,33,"CMS_CHECKOUT.POSTAL_CODE")),t(2),f("ngModel",e.newAddress.postalCode),h("placeholder",p(28,35,"CMS_CHECKOUT.POSTAL_CODE_PLACEHOLDER")),t(4),c(p(32,37,"CMS_CHECKOUT.PROVINCE")),t(2),f("ngModel",e.newAddress.stateProvince),h("placeholder",p(34,39,"CMS_CHECKOUT.PROVINCE_PLACEHOLDER")),t(4),c(p(38,41,"CMS_CHECKOUT.COUNTRY")),t(2),f("ngModel",e.newAddress.countryCode),h("placeholder",p(40,43,"CMS_CHECKOUT.COUNTRY_PLACEHOLDER"))}}function ie(n,u){if(n&1&&(a(0,"p",23),r(1),i()),n&2){let e=C(2);t(),c(e.couponError)}}function ne(n,u){if(n&1){let e=w();a(0,"div",24)(1,"span",52),r(2),l(3,"translate"),i(),a(4,"button",53),I("click",function(){m(e);let o=C(2);return _(o.removeCoupon())}),r(5),l(6,"translate"),i()()}if(n&2){let e=C(2);t(2),k(' Coupon "',e.appliedCoupon.code,'" ',p(3,4,"CMS_CHECKOUT.COUPON_APPLIED")," (",e.appliedCoupon.discountType==="percentage"?e.appliedCoupon.discountValue+"%":"\u20AC"+e.appliedCoupon.discountValue,") "),t(3),c(p(6,6,"CMS_CHECKOUT.COUPON_REMOVE"))}}function oe(n,u){if(n&1&&(a(0,"span",55),r(1),i()),n&2){let e=C().$implicit;t(),x("(",e.productVariant.name,")")}}function ae(n,u){if(n&1&&(a(0,"div",29)(1,"span",54),r(2),l(3,"translate"),E(4,oe,2,1,"span",55),r(5),i(),a(6,"span",56),r(7),i()()),n&2){let e=u.$implicit,d=C(2);t(2),x(" ",(e.productVariant==null||e.productVariant.product==null?null:e.productVariant.product.name)||p(3,4,"CMS_CHECKOUT.PRODUCT")," "),t(2),g(e.productVariant!=null&&e.productVariant.name?4:-1),t(),x(" x",e.quantity," "),t(2),x("\u20AC ",(d.getItemPrice(e)*e.quantity).toFixed(2),"")}}function re(n,u){if(n&1&&(a(0,"div",33)(1,"span"),r(2),l(3,"translate"),i(),a(4,"span"),r(5),i()()),n&2){let e=C(2);t(2),c(p(3,2,"CMS_CHECKOUT.DISCOUNT")),t(3),x("-\u20AC ",e.discount.toFixed(2),"")}}function de(n,u){n&1&&(a(0,"span",34),r(1),l(2,"translate"),i()),n&2&&(t(),c(p(2,1,"CMS_CHECKOUT.FREE")))}function le(n,u){if(n&1&&(a(0,"span",32),r(1),i()),n&2){let e=C(2);t(),x("\u20AC ",e.shippingCost.toFixed(2),"")}}function pe(n,u){if(n&1&&(a(0,"div",36),r(1),i()),n&2){let e=C(2);t(),c(e.error)}}function se(n,u){n&1&&(O(),a(0,"svg",57),M(1,"circle",58)(2,"path",59),i(),r(3),l(4,"translate")),n&2&&(t(3),x(" ",p(4,1,"CMS_CHECKOUT.PROCESSING")," "))}function ce(n,u){n&1&&(r(0),l(1,"translate")),n&2&&x(" ",p(1,1,"CMS_CHECKOUT.PAY_STRIPE")," ")}function Ce(n,u){if(n&1){let e=w();a(0,"div",9)(1,"div",15)(2,"div",16)(3,"h2",17),r(4),l(5,"translate"),i(),E(6,ee,3,0,"div",18)(7,te,41,45,"div",19),i(),a(8,"div",16)(9,"h2",17),r(10),l(11,"translate"),i(),a(12,"div",20)(13,"input",21),l(14,"translate"),S("ngModelChange",function(o){m(e);let s=C();return v(s.couponCode,o)||(s.couponCode=o),_(o)}),i(),a(15,"button",22),I("click",function(){m(e);let o=C();return _(o.applyCoupon())}),r(16),l(17,"translate"),i()(),E(18,ie,2,1,"p",23)(19,ne,7,8,"div",24),i(),a(20,"div",16)(21,"h2",17),r(22),l(23,"translate"),i(),a(24,"textarea",25),l(25,"translate"),S("ngModelChange",function(o){m(e);let s=C();return v(s.customerNotes,o)||(s.customerNotes=o),_(o)}),i()()(),a(26,"div",26)(27,"div",27)(28,"h2",17),r(29),l(30,"translate"),i(),a(31,"div",28),b(32,ae,8,6,"div",29,J),i(),a(34,"div",30)(35,"div",31)(36,"span"),r(37),l(38,"translate"),i(),a(39,"span",32),r(40),i()(),E(41,re,6,4,"div",33),a(42,"div",31)(43,"span"),r(44),l(45,"translate"),i(),E(46,de,3,3,"span",34)(47,le,2,1,"span",32),i(),a(48,"div",35)(49,"span"),r(50),l(51,"translate"),i(),a(52,"span"),r(53),i()()(),E(54,pe,2,1,"div",36),a(55,"button",37),I("click",function(){m(e);let o=C();return _(o.handleCheckout())}),E(56,se,5,3)(57,ce,2,3),i()()()()}if(n&2){let e=C();t(4),c(p(5,23,"CMS_CHECKOUT.SHIPPING_ADDRESS")),t(2),g(e.addresses.length>0?6:7),t(4),c(p(11,25,"CMS_CHECKOUT.COUPON")),t(3),f("ngModel",e.couponCode),h("placeholder",p(14,27,"CMS_CHECKOUT.COUPON_PLACEHOLDER")),t(2),h("disabled",!e.couponCode||e.validatingCoupon),t(),x(" ",p(17,29,"CMS_CHECKOUT.APPLY")," "),t(2),g(e.couponError?18:-1),t(),g(e.appliedCoupon?19:-1),t(3),c(p(23,31,"CMS_CHECKOUT.NOTES")),t(2),f("ngModel",e.customerNotes),h("placeholder",p(25,33,"CMS_CHECKOUT.NOTES_PLACEHOLDER")),t(5),c(p(30,35,"CMS_CHECKOUT.SUMMARY")),t(3),A(e.cart.cartItems),t(5),c(p(38,37,"CMS_CHECKOUT.SUBTOTAL")),t(3),x("\u20AC ",e.subtotal.toFixed(2),""),t(),g(e.discount>0?41:-1),t(3),c(p(45,39,"CMS_CHECKOUT.SHIPPING")),t(2),g(e.subtotal>=50?46:47),t(4),c(p(51,41,"CMS_CHECKOUT.TOTAL")),t(3),x("\u20AC ",e.total.toFixed(2),""),t(),g(e.error?54:-1),t(),h("disabled",e.processing),t(),g(e.processing?56:57)}}var Se=(()=>{class n{api;auth;translate;cart=null;customer=null;addresses=[];selectedAddressId=null;newAddress={recipientName:"",addressLine1:"",city:"",postalCode:"",stateProvince:"",countryCode:"IT"};couponCode="";appliedCoupon=null;couponError=null;validatingCoupon=!1;customerNotes="";loading=!0;processing=!1;error=null;constructor(e,d,o){this.api=e,this.auth=d,this.translate=o}ngOnInit(){this.loadData()}getItemPrice(e){let d=e.productVariant?.product,o=d?parseFloat(d.finalPrice):0,s=e.productVariant?parseFloat(e.productVariant.priceAdjustment):0;return o+s}get subtotal(){return this.cart?this.cart.cartItems.reduce((e,d)=>e+this.getItemPrice(d)*d.quantity,0):0}get discount(){return this.appliedCoupon?this.appliedCoupon.discountType==="percentage"?this.subtotal*parseFloat(this.appliedCoupon.discountValue)/100:parseFloat(this.appliedCoupon.discountValue):0}get shippingCost(){return this.subtotal>=50?0:4.99}get total(){return Math.max(0,this.subtotal-this.discount+this.shippingCost)}applyCoupon(){return y(this,null,function*(){if(this.couponCode){this.validatingCoupon=!0,this.couponError=null;try{let e=yield this.api.validateCoupon(this.couponCode);this.appliedCoupon={code:e.code,discountType:e.discountType,discountValue:e.discountValue}}catch{this.couponError=this.translate.instant("CMS_CHECKOUT.COUPON_INVALID")}finally{this.validatingCoupon=!1}}})}removeCoupon(){this.appliedCoupon=null,this.couponCode="",this.couponError=null}handleCheckout(){return y(this,null,function*(){if(!(!this.cart||!this.customer)){this.processing=!0,this.error=null;try{let e=this.selectedAddressId;!e&&this.newAddress.recipientName&&this.newAddress.addressLine1&&(e=(yield this.api.createAddress(this.customer.id,V(P({},this.newAddress),{isShipping:!0,isBilling:!0,isDefault:!0}))).id);let d=this.cart.cartItems.map(s=>({variantId:s.productVariantId,quantity:s.quantity})),o=yield this.api.createCheckout({items:d,shippingAddressId:e||void 0,billingAddressId:e||void 0,couponCode:this.appliedCoupon?.code,customerNotes:this.customerNotes||void 0});o.url&&(window.location.href=o.url)}catch(e){this.error=e instanceof Error?e.message:this.translate.instant("CMS_CHECKOUT.ERROR")}finally{this.processing=!1}}})}loadData(){return y(this,null,function*(){try{this.customer=yield this.auth.getMe();let[e,d]=yield Promise.all([this.api.getCart(this.customer.id),this.api.getAddresses(this.customer.id)]);if(this.cart=e,this.addresses=d,d.length>0){let o=d.find(s=>s.isDefault)||d[0];this.selectedAddressId=o.id}}catch{this.cart=null}finally{this.loading=!1}})}static \u0275fac=function(d){return new(d||n)(T(F),T(W),T(N))};static \u0275cmp=B({type:n,selectors:[["app-checkout"]],decls:12,vars:4,consts:[[1,"min-h-screen","pt-28","pb-20",2,"background","var(--bg-primary)"],[1,"container-narrow"],[1,"flex","items-center","gap-3","mb-8"],["routerLink","/cart",1,"text-[var(--text-muted)]","hover:text-white","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-white"],[1,"space-y-6","animate-glow-pulse"],[1,"glass-card","rounded-2xl","p-12","text-center"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"glass-card","rounded-xl","p-6","h-48"],[1,"glass-card","rounded-xl","p-6","h-32"],[1,"text-xl","font-semibold","text-white","mb-2"],[1,"text-[var(--text-secondary)]","mb-6"],["routerLink","/products",1,"btn-primary","inline-block","px-6","py-3","rounded-xl"],[1,"lg:col-span-2","space-y-6"],[1,"glass-card","rounded-xl","p-6"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3"],[1,"space-y-4"],[1,"flex","gap-3"],["type","text","name","coupon",1,"flex-1","input-glass",3,"ngModelChange","ngModel","placeholder"],[1,"btn-secondary","px-5","py-2.5","rounded-xl","font-medium","disabled:opacity-40","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-sm","text-red-400","mt-2"],[1,"mt-3","flex","items-center","justify-between","glass","border","border-emerald-500/20","rounded-xl","px-4","py-2.5"],["name","notes","rows","3",1,"w-full","input-glass","resize-none",3,"ngModelChange","ngModel","placeholder"],[1,"lg:col-span-1"],[1,"glass-card","rounded-xl","p-6","sticky","top-28"],[1,"space-y-3","mb-4"],[1,"flex","justify-between","text-sm"],[1,"border-t","border-white/[0.06]","pt-3","space-y-2","text-sm"],[1,"flex","justify-between","text-[var(--text-secondary)]"],[1,"text-white"],[1,"flex","justify-between","text-emerald-400"],[1,"text-emerald-400","font-medium"],[1,"border-t","border-white/[0.06]","pt-3","flex","justify-between","font-semibold","text-white","text-base"],[1,"mt-4","glass","border","border-red-500/20","text-red-400","px-4","py-3","rounded-xl","text-sm"],[1,"mt-6","w-full","btn-primary","py-4","px-6","rounded-xl","font-semibold","text-base","flex","items-center","justify-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[3,"class"],["type","radio","name","address",1,"mt-1","w-4","h-4","accent-[var(--accent-cyan)]",3,"ngModelChange","value","ngModel"],[1,"font-medium","text-white"],[1,"text-sm","text-[var(--text-secondary)]"],[1,"text-sm","text-[var(--text-secondary)]","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"sm:col-span-2"],[1,"block","text-sm","font-medium","text-[var(--text-secondary)]","mb-1"],["type","text","name","recipientName",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","addressLine1",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","city",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","postalCode",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","stateProvince",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],["type","text","name","countryCode",1,"w-full","input-glass",3,"ngModelChange","ngModel","placeholder"],[1,"text-sm","text-emerald-400","font-medium"],[1,"text-emerald-400","hover:text-emerald-300","text-sm","font-medium",3,"click"],[1,"text-[var(--text-secondary)]","truncate","mr-2"],[1,"text-[var(--text-muted)]"],[1,"text-white","font-medium","whitespace-nowrap"],["viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4","fill","none",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(d,o){d&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),O(),a(4,"svg",4),M(5,"path",5),i()(),H(),a(6,"h1",6),r(7),l(8,"translate"),i()(),E(9,Q,3,0,"div",7)(10,X,10,9,"div",8)(11,Ce,58,43,"div",9),i()()),d&2&&(t(7),c(p(8,2,"CMS_CHECKOUT.TITLE")),t(2),g(o.loading?9:!o.cart||o.cart.cartItems.length===0?10:11))},dependencies:[U,K,z,j,G,Y,q,R,D],encapsulation:2})}return n})();export{Se as CheckoutComponent};
