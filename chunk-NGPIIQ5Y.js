import{a as j}from"./chunk-NSUP7E7A.js";import{c as H,f as G,j as $,k as W,l as Y,q}from"./chunk-FDF7ZVEQ.js";import{a as z}from"./chunk-OTJICIWI.js";import"./chunk-4DB2YMOA.js";import"./chunk-WB4KDGBB.js";import{b as L,c as F,f as U}from"./chunk-ELX5U2HF.js";import{$ as g,$a as a,Ba as y,Fa as A,Ka as f,Ob as B,Qa as _,Ta as P,Va as S,Xa as R,Ya as E,Za as I,_ as x,_a as o,aa as M,ab as h,ba as w,bb as T,c as v,cb as C,db as s,jb as l,kb as c,lb as k,ob as N,pb as V,qb as D,rb as O,vb as m,wb as u,xa as n}from"./chunk-NPZXHD37.js";var J=(r,p)=>p.id;function K(r,p){r&1&&(o(0,"div",4),h(1,"div",7),a())}function Q(r,p){r&1&&(o(0,"div",5),l(1),m(2,"translate"),a()),r&2&&(n(),c(u(2,1,"CMS_ADMIN.NO_CUSTOMERS")))}function X(r,p){if(r&1&&(o(0,"p",32),l(1),a()),r&2){let e=s().$implicit;n(),c(e.phone)}}function Z(r,p){if(r&1&&(o(0,"option",18),l(1),m(2,"translate"),a()),r&2){let e=p.$implicit,t=s(3);_("value",e),n(),c(u(2,2,t.getRoleLabel(e)))}}function ee(r,p){r&1&&h(0,"div",36)}function te(r,p){if(r&1){let e=T();o(0,"tr",13)(1,"td",28)(2,"div",29)(3,"div",30)(4,"span",31),l(5),a()(),o(6,"div")(7,"p",31),l(8),a(),f(9,X,2,1,"p",32),a()()(),o(10,"td",33),l(11),a(),o(12,"td",28)(13,"span"),l(14),m(15,"translate"),m(16,"translate"),a()(),o(17,"td",28)(18,"div",34)(19,"select",35),C("ngModelChange",function(i){let d=x(e).$implicit,b=s(2);return g(b.onRoleChange(d,i))}),E(20,Z,3,4,"option",18,R),a(),f(22,ee,1,0,"div",36),a()(),o(23,"td",33),l(24),a()()}if(r&2){let e=p.$implicit,t=s(2);n(5),c(t.getInitials(e.fullName)),n(3),c(e.fullName),n(),S(e.phone?9:-1),n(2),c(e.email),n(2),P(e.customerType==="business"?"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-500/15 text-blue-400":"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white/[0.08] text-[var(--text-secondary)]"),n(),k(" ",e.customerType==="business"?u(15,11,"CMS_ACCOUNT.BUSINESS"):u(16,13,"CMS_ACCOUNT.PRIVATE")," "),n(5),_("ngModel",e.role)("disabled",t.savingRoleId===e.id),n(),I(t.getAssignableRoles()),n(2),S(t.savingRoleId===e.id?22:-1),n(2),c(t.formatDate(e.createdAt))}}function ie(r,p){r&1&&(o(0,"span",37),l(1,"\u2026"),a())}function ne(r,p){if(r&1){let e=T();o(0,"button",39),C("click",function(){x(e);let i=s().$implicit,d=s(2);return g(d.goToPage(i))}),l(1),a()}if(r&2){let e=s().$implicit,t=s(2);P(e===t.currentPage?"min-w-[32px] h-8 rounded text-sm font-medium bg-cyan-500 text-white transition-colors":"min-w-[32px] h-8 rounded text-sm text-[var(--text-secondary)] hover:text-white hover:bg-white/[0.08] transition-colors"),n(),c(e)}}function oe(r,p){if(r&1&&f(0,ie,2,0,"span",37)(1,ne,2,3,"button",38),r&2){let e=p.$implicit;S(e===-1?0:1)}}function re(r,p){if(r&1){let e=T();o(0,"div",8)(1,"table",9)(2,"thead")(3,"tr",10)(4,"th",11),l(5),m(6,"translate"),a(),o(7,"th",11),l(8),m(9,"translate"),a(),o(10,"th",11),l(11),m(12,"translate"),a(),o(13,"th",11),l(14),m(15,"translate"),a(),o(16,"th",11),l(17),m(18,"translate"),a()()(),o(19,"tbody",12),E(20,te,25,15,"tr",13,J),a()()(),o(22,"div",14)(23,"div",15)(24,"p",16),l(25),m(26,"translate"),a(),o(27,"select",17),O("ngModelChange",function(i){x(e);let d=s();return D(d.pageSize,i)||(d.pageSize=i),g(i)}),C("ngModelChange",function(i){x(e);let d=s();return g(d.onPageSizeChange(i))}),o(28,"option",18),l(29,"20"),a(),o(30,"option",18),l(31,"50"),a(),o(32,"option",18),l(33,"100"),a()()(),o(34,"div",19)(35,"button",20),C("click",function(){x(e);let i=s();return g(i.goToPage(1))}),M(),o(36,"svg",21),h(37,"path",22),a()(),w(),o(38,"button",23),C("click",function(){x(e);let i=s();return g(i.goToPage(i.currentPage-1))}),M(),o(39,"svg",21),h(40,"path",24),a()(),E(41,oe,2,1,null,null,R),w(),o(43,"button",23),C("click",function(){x(e);let i=s();return g(i.goToPage(i.currentPage+1))}),M(),o(44,"svg",21),h(45,"path",25),a()(),w(),o(46,"button",26),C("click",function(){x(e);let i=s();return g(i.goToPage(i.totalPages))}),M(),o(47,"svg",21),h(48,"path",27),a()()()()}if(r&2){let e=s();n(5),c(u(6,17,"CMS_ADMIN.TH_CUSTOMER")),n(3),c(u(9,19,"CMS_ADMIN.TH_EMAIL")),n(3),c(u(12,21,"CMS_ADMIN.TH_TYPE")),n(3),c(u(15,23,"CMS_ADMIN.TH_ROLE")),n(3),c(u(18,25,"CMS_ADMIN.TH_REGISTERED")),n(3),I(e.customers),n(5),N(" ",(e.currentPage-1)*e.pageSize+1,"\u2013",e.min(e.currentPage*e.pageSize,e.total)," ",u(26,27,"CMS_ADMIN.PAGINATION_OF")," ",e.total," "),n(2),V("ngModel",e.pageSize),n(),_("value",20),n(2),_("value",50),n(2),_("value",100),n(3),_("disabled",e.currentPage===1),n(3),_("disabled",e.currentPage===1),n(3),I(e.visiblePages()),n(2),_("disabled",e.currentPage===e.totalPages),n(3),_("disabled",e.currentPage===e.totalPages)}}function ae(r,p){if(r&1&&(o(0,"div",6),l(1),a()),r&2){let e=s();n(),k(" ",e.errorMessage," ")}}var xe=(()=>{class r{api;auth;translate;customers=[];availableRoles=[];loading=!0;savingRoleId=null;errorMessage="";currentPage=1;pageSize=20;total=0;totalPages=1;min=Math.min;constructor(e,t,i){this.api=e,this.auth=t,this.translate=i}ngOnInit(){this.loadRoles(),this.loadCustomers()}getInitials(e){return e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)}formatDate(e){return new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})}getRoleLabel(e){return{funnel_anonimo:"CMS_ADMIN.ROLE_FUNNEL_ANONIMO",customer:"CMS_ADMIN.ROLE_CUSTOMER",admin:"CMS_ADMIN.ROLE_ADMIN",super_admin:"CMS_ADMIN.ROLE_SUPER_ADMIN"}[e]??e}getAssignableRoles(){return this.auth.user()?.role==="super_admin"?this.availableRoles:this.availableRoles.filter(t=>t!=="super_admin")}visiblePages(){let e=this.totalPages,t=this.currentPage;if(e<=7)return Array.from({length:e},(d,b)=>b+1);let i=[1];t>3&&i.push(-1);for(let d=Math.max(2,t-1);d<=Math.min(e-1,t+1);d++)i.push(d);return t<e-2&&i.push(-1),i.push(e),i}goToPage(e){return v(this,null,function*(){e<1||e>this.totalPages||e===this.currentPage||(this.currentPage=e,yield this.loadCustomers())})}onPageSizeChange(e){return v(this,null,function*(){this.pageSize=e,this.currentPage=1,yield this.loadCustomers()})}onRoleChange(e,t){return v(this,null,function*(){if(t!==e.role){this.savingRoleId=e.id,this.errorMessage="";try{let i=yield this.api.updateCustomerRole(e.id,t),d=this.customers.findIndex(b=>b.id===e.id);d>=0&&(this.customers[d]=i)}catch(i){console.error("Role update error:",i),this.errorMessage=this.translate.instant("CMS_ADMIN.ROLE_UPDATE_ERROR")}finally{this.savingRoleId=null}}})}loadRoles(){return v(this,null,function*(){try{let{roles:e}=yield this.api.getCustomerRoles();this.availableRoles=e}catch(e){console.error("Error loading roles:",e)}})}loadCustomers(){return v(this,null,function*(){this.loading=!0;try{let e=yield this.api.getAllCustomers(this.currentPage,this.pageSize);this.customers=e.data,this.total=e.total,this.totalPages=e.totalPages}catch(e){console.error("Error loading customers:",e)}finally{this.loading=!1}})}static \u0275fac=function(t){return new(t||r)(y(z),y(j),y(L))};static \u0275cmp=A({type:r,selectors:[["app-customers"]],decls:14,vars:8,consts:[[1,"flex","items-center","justify-between","mb-8"],[1,"text-2xl","font-semibold","text-white"],[1,"text-[var(--text-secondary)]","mt-1"],[1,"glass-card","rounded-xl"],[1,"p-8","text-center"],[1,"p-8","text-center","text-[var(--text-secondary)]"],[1,"mt-4","bg-red-500/10","border","border-red-500/20","rounded-lg","p-3","text-red-400","text-sm"],[1,"animate-spin","h-8","w-8","border-2","border-cyan-400","border-t-transparent","rounded-full","mx-auto"],[1,"overflow-x-auto"],[1,"w-full"],[1,"text-left","text-xs","font-medium","text-[var(--text-muted)]","uppercase","tracking-wider","border-b","border-white/[0.06]"],[1,"px-6","py-3"],[1,"divide-y","divide-white/[0.06]"],[1,"hover:bg-white/[0.04]","transition-colors"],[1,"flex","items-center","justify-between","px-6","py-4","border-t","border-white/[0.06]"],[1,"flex","items-center","gap-4"],[1,"text-sm","text-[var(--text-muted)]"],[1,"bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-2","py-1","text-sm","text-white","focus:outline-none","focus:border-cyan-400","cursor-pointer",3,"ngModelChange","ngModel"],[1,"bg-gray-900",3,"value"],[1,"flex","items-center","gap-1"],["title","Prima pagina",1,"p-1.5","rounded","text-[var(--text-secondary)]","hover:text-white","hover:bg-white/[0.08]","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 19l-7-7 7-7M18 19l-7-7 7-7"],[1,"p-1.5","rounded","text-[var(--text-secondary)]","hover:text-white","hover:bg-white/[0.08]","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],["title","Ultima pagina",1,"p-1.5","rounded","text-[var(--text-secondary)]","hover:text-white","hover:bg-white/[0.08]","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 5l7 7-7 7M6 5l7 7-7 7"],[1,"px-6","py-4"],[1,"flex","items-center","gap-3"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","flex-shrink-0",2,"background","var(--gradient-aurora)"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-[var(--text-muted)]"],[1,"px-6","py-4","text-sm","text-[var(--text-secondary)]"],[1,"flex","items-center","gap-2"],[1,"bg-white/[0.06]","border","border-white/[0.1]","rounded-lg","px-2","py-1","text-sm","text-white","focus:outline-none","focus:border-cyan-400","disabled:opacity-50","cursor-pointer",3,"ngModelChange","ngModel","disabled"],[1,"animate-spin","h-4","w-4","border-2","border-cyan-400","border-t-transparent","rounded-full","flex-shrink-0"],[1,"px-1.5","text-[var(--text-muted)]","text-sm","select-none"],[3,"class"],[3,"click"]],template:function(t,i){t&1&&(o(0,"div")(1,"div",0)(2,"div")(3,"h1",1),l(4),m(5,"translate"),a(),o(6,"p",2),l(7),m(8,"translate"),a()()(),o(9,"div",3),f(10,K,2,0,"div",4)(11,Q,3,3,"div",5)(12,re,49,29),a(),f(13,ae,2,1,"div",6),a()),t&2&&(n(4),c(u(5,4,"CMS_ADMIN.CUSTOMERS")),n(3),c(u(8,6,"CMS_ADMIN.MANAGE_CUSTOMERS")),n(3),S(i.loading?10:i.customers.length===0?11:12),n(3),S(i.errorMessage?13:-1))},dependencies:[B,q,W,Y,$,H,G,U,F],encapsulation:2})}return r})();export{xe as CustomersComponent};
