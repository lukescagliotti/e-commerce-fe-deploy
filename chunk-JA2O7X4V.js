import{a as j,b as Y,e as q,g as G,m as z}from"./chunk-IPPW7I6G.js";import{a as D}from"./chunk-Z7I3XMZR.js";import{a as F}from"./chunk-DUCYLONY.js";import"./chunk-KDXJ3RTB.js";import{f as N}from"./chunk-LN4SGBIJ.js";import{$ as b,$a as u,Da as U,Eb as L,Ha as g,Na as M,Pb as K,Qa as H,Qb as W,Sa as h,Tb as R,Ua as k,Va as A,Wa as a,Xa as i,Ya as T,Z as m,Za as y,_ as x,_a as I,a as O,aa as B,b as P,c as S,eb as r,fb as c,gb as _,ib as V,jb as f,kb as v,lb as w,ob as s,pb as p,va as t,za as E}from"./chunk-PVRYHEF3.js";var J=(n,C)=>C.id;function Q(n,C){n&1&&(a(0,"div",7),T(1,"div",10)(2,"div",11),i())}function X(n,C){n&1&&(a(0,"div",8)(1,"h2",12),r(2),s(3,"translate"),i(),a(4,"p",13),r(5),s(6,"translate"),i(),a(7,"a",14),r(8),s(9,"translate"),i()()),n&2&&(t(2),c(p(3,3,"CMS_CHECKOUT.EMPTY_TITLE")),t(3),c(p(6,5,"CMS_CHECKOUT.EMPTY_DESC")),t(3),_(" ",p(9,7,"CMS_CHECKOUT.DISCOVER")," "))}function Z(n,C){if(n&1&&(a(0,"p",41),r(1),i()),n&2){let e=u().$implicit;t(),c(e.addressLine2)}}function $(n,C){if(n&1){let e=y();a(0,"label")(1,"input",39),w("ngModelChange",function(o){m(e);let l=u(3);return v(l.selectedAddressId,o)||(l.selectedAddressId=o),x(o)}),i(),a(2,"div")(3,"p",40),r(4),i(),a(5,"p",41),r(6),i(),g(7,Z,2,1,"p",41),a(8,"p",41),r(9),i()()()}if(n&2){let e=C.$implicit,d=u(3);H(d.selectedAddressId===e.id?"flex items-start gap-3 p-4 rounded-xl glass-strong border border-[var(--accent-cyan)] cursor-pointer":"flex items-start gap-3 p-4 rounded-xl glass-subtle border border-white/[0.06] hover:border-white/[0.12] cursor-pointer transition-colors"),t(),M("value",e.id),f("ngModel",d.selectedAddressId),t(3),c(e.recipientName),t(2),c(e.addressLine1),t(),h(e.addressLine2?7:-1),t(2),V("",e.postalCode," ",e.city," ",e.stateProvince,"")}}function ee(n,C){if(n&1&&(a(0,"div",18),k(1,$,10,10,"label",38,J),i()),n&2){let e=u(2);t(),A(e.addresses)}}function te(n,C){if(n&1){let e=y();a(0,"div",19)(1,"p",42),r(2),s(3,"translate"),i(),a(4,"div",43)(5,"div",44)(6,"label",45),r(7),s(8,"translate"),i(),a(9,"input",46),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.recipientName,o)||(l.newAddress.recipientName=o),x(o)}),i()(),a(10,"div",44)(11,"label",45),r(12),s(13,"translate"),i(),a(14,"input",47),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.addressLine1,o)||(l.newAddress.addressLine1=o),x(o)}),i()(),a(15,"div")(16,"label",45),r(17),s(18,"translate"),i(),a(19,"input",48),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.city,o)||(l.newAddress.city=o),x(o)}),i()(),a(20,"div")(21,"label",45),r(22),s(23,"translate"),i(),a(24,"input",49),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.postalCode,o)||(l.newAddress.postalCode=o),x(o)}),i()(),a(25,"div")(26,"label",45),r(27),s(28,"translate"),i(),a(29,"input",50),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.stateProvince,o)||(l.newAddress.stateProvince=o),x(o)}),i()(),a(30,"div")(31,"label",45),r(32),s(33,"translate"),i(),a(34,"input",51),w("ngModelChange",function(o){m(e);let l=u(2);return v(l.newAddress.countryCode,o)||(l.newAddress.countryCode=o),x(o)}),i()()()()}if(n&2){let e=u(2);t(2),c(p(3,13,"CMS_CHECKOUT.NO_ADDRESS")),t(5),c(p(8,15,"CMS_CHECKOUT.RECIPIENT")),t(2),f("ngModel",e.newAddress.recipientName),t(3),c(p(13,17,"CMS_CHECKOUT.ADDRESS")),t(2),f("ngModel",e.newAddress.addressLine1),t(3),c(p(18,19,"CMS_CHECKOUT.CITY")),t(2),f("ngModel",e.newAddress.city),t(3),c(p(23,21,"CMS_CHECKOUT.POSTAL_CODE")),t(2),f("ngModel",e.newAddress.postalCode),t(3),c(p(28,23,"CMS_CHECKOUT.PROVINCE")),t(2),f("ngModel",e.newAddress.stateProvince),t(3),c(p(33,25,"CMS_CHECKOUT.COUNTRY")),t(2),f("ngModel",e.newAddress.countryCode)}}function ie(n,C){if(n&1&&(a(0,"p",23),r(1),i()),n&2){let e=u(2);t(),c(e.couponError)}}function ne(n,C){if(n&1){let e=y();a(0,"div",24)(1,"span",52),r(2),s(3,"translate"),i(),a(4,"button",53),I("click",function(){m(e);let o=u(2);return x(o.removeCoupon())}),r(5),s(6,"translate"),i()()}if(n&2){let e=u(2);t(2),V(' Coupon "',e.appliedCoupon.code,'" ',p(3,4,"CMS_CHECKOUT.COUPON_APPLIED")," (",e.appliedCoupon.discountType==="percentage"?e.appliedCoupon.discountValue+"%":"\u20AC"+e.appliedCoupon.discountValue,") "),t(3),c(p(6,6,"CMS_CHECKOUT.COUPON_REMOVE"))}}function oe(n,C){if(n&1&&(a(0,"span",55),r(1),i()),n&2){let e=u().$implicit;t(),_("(",e.productVariant.name,")")}}function ae(n,C){if(n&1&&(a(0,"div",29)(1,"span",54),r(2),s(3,"translate"),g(4,oe,2,1,"span",55),r(5),i(),a(6,"span",56),r(7),i()()),n&2){let e=C.$implicit,d=u(2);t(2),_(" ",(e.productVariant==null||e.productVariant.product==null?null:e.productVariant.product.name)||p(3,4,"CMS_CHECKOUT.PRODUCT")," "),t(2),h(e.productVariant!=null&&e.productVariant.name?4:-1),t(),_(" x",e.quantity," "),t(2),_("\u20AC ",(d.getItemPrice(e)*e.quantity).toFixed(2),"")}}function re(n,C){if(n&1&&(a(0,"div",33)(1,"span"),r(2),s(3,"translate"),i(),a(4,"span"),r(5),i()()),n&2){let e=u(2);t(2),c(p(3,2,"CMS_CHECKOUT.DISCOUNT")),t(3),_("-\u20AC ",e.discount.toFixed(2),"")}}function de(n,C){n&1&&(a(0,"span",34),r(1),s(2,"translate"),i()),n&2&&(t(),c(p(2,1,"CMS_CHECKOUT.FREE")))}function le(n,C){if(n&1&&(a(0,"span",32),r(1),i()),n&2){let e=u(2);t(),_("\u20AC ",e.shippingCost.toFixed(2),"")}}function se(n,C){if(n&1&&(a(0,"div",36),r(1),i()),n&2){let e=u(2);t(),c(e.error)}}function pe(n,C){n&1&&(b(),a(0,"svg",57),T(1,"circle",58)(2,"path",59),i(),r(3),s(4,"translate")),n&2&&(t(3),_(" ",p(4,1,"CMS_CHECKOUT.PROCESSING")," "))}function ce(n,C){n&1&&(r(0),s(1,"translate")),n&2&&_(" ",p(1,1,"CMS_CHECKOUT.PAY_STRIPE")," ")}function ue(n,C){if(n&1){let e=y();a(0,"div",9)(1,"div",15)(2,"div",16)(3,"h2",17),r(4),s(5,"translate"),i(),g(6,ee,3,0,"div",18)(7,te,35,27,"div",19),i(),a(8,"div",16)(9,"h2",17),r(10),s(11,"translate"),i(),a(12,"div",20)(13,"input",21),w("ngModelChange",function(o){m(e);let l=u();return v(l.couponCode,o)||(l.couponCode=o),x(o)}),i(),a(14,"button",22),I("click",function(){m(e);let o=u();return x(o.applyCoupon())}),r(15),s(16,"translate"),i()(),g(17,ie,2,1,"p",23)(18,ne,7,8,"div",24),i(),a(19,"div",16)(20,"h2",17),r(21),s(22,"translate"),i(),a(23,"textarea",25),w("ngModelChange",function(o){m(e);let l=u();return v(l.customerNotes,o)||(l.customerNotes=o),x(o)}),i()()(),a(24,"div",26)(25,"div",27)(26,"h2",17),r(27),s(28,"translate"),i(),a(29,"div",28),k(30,ae,8,6,"div",29,J),i(),a(32,"div",30)(33,"div",31)(34,"span"),r(35),s(36,"translate"),i(),a(37,"span",32),r(38),i()(),g(39,re,6,4,"div",33),a(40,"div",31)(41,"span"),r(42),s(43,"translate"),i(),g(44,de,3,3,"span",34)(45,le,2,1,"span",32),i(),a(46,"div",35)(47,"span"),r(48),s(49,"translate"),i(),a(50,"span"),r(51),i()()(),g(52,se,2,1,"div",36),a(53,"button",37),I("click",function(){m(e);let o=u();return x(o.handleCheckout())}),g(54,pe,5,3)(55,ce,2,3),i()()()()}if(n&2){let e=u();t(4),c(p(5,21,"CMS_CHECKOUT.SHIPPING_ADDRESS")),t(2),h(e.addresses.length>0?6:7),t(4),c(p(11,23,"CMS_CHECKOUT.COUPON")),t(3),f("ngModel",e.couponCode),t(),M("disabled",!e.couponCode||e.validatingCoupon),t(),_(" ",p(16,25,"CMS_CHECKOUT.APPLY")," "),t(2),h(e.couponError?17:-1),t(),h(e.appliedCoupon?18:-1),t(3),c(p(22,27,"CMS_CHECKOUT.NOTES")),t(2),f("ngModel",e.customerNotes),t(4),c(p(28,29,"CMS_CHECKOUT.SUMMARY")),t(3),A(e.cart.cartItems),t(5),c(p(36,31,"CMS_CHECKOUT.SUBTOTAL")),t(3),_("\u20AC ",e.subtotal.toFixed(2),""),t(),h(e.discount>0?39:-1),t(3),c(p(43,33,"CMS_CHECKOUT.SHIPPING")),t(2),h(e.subtotal>=50?44:45),t(4),c(p(49,35,"CMS_CHECKOUT.TOTAL")),t(3),_("\u20AC ",e.total.toFixed(2),""),t(),h(e.error?52:-1),t(),M("disabled",e.processing),t(),h(e.processing?54:55)}}var ye=(()=>{class n{api;auth;translate;cart=null;customer=null;addresses=[];selectedAddressId=null;newAddress={recipientName:"",addressLine1:"",city:"",postalCode:"",stateProvince:"",countryCode:"IT"};couponCode="";appliedCoupon=null;couponError=null;validatingCoupon=!1;customerNotes="";loading=!0;processing=!1;error=null;constructor(e,d,o){this.api=e,this.auth=d,this.translate=o}ngOnInit(){this.loadData()}getItemPrice(e){let d=e.productVariant?.product,o=d?parseFloat(d.finalPrice):0,l=e.productVariant?parseFloat(e.productVariant.priceAdjustment):0;return o+l}get subtotal(){return this.cart?this.cart.cartItems.reduce((e,d)=>e+this.getItemPrice(d)*d.quantity,0):0}get discount(){return this.appliedCoupon?this.appliedCoupon.discountType==="percentage"?this.subtotal*parseFloat(this.appliedCoupon.discountValue)/100:parseFloat(this.appliedCoupon.discountValue):0}get shippingCost(){return this.subtotal>=50?0:4.99}get total(){return Math.max(0,this.subtotal-this.discount+this.shippingCost)}applyCoupon(){return S(this,null,function*(){if(this.couponCode){this.validatingCoupon=!0,this.couponError=null;try{let e=yield this.api.validateCoupon(this.couponCode);this.appliedCoupon={code:e.code,discountType:e.discountType,discountValue:e.discountValue}}catch{this.couponError=this.translate.instant("CMS_CHECKOUT.COUPON_INVALID")}finally{this.validatingCoupon=!1}}})}removeCoupon(){this.appliedCoupon=null,this.couponCode="",this.couponError=null}handleCheckout(){return S(this,null,function*(){if(!(!this.cart||!this.customer)){this.processing=!0,this.error=null;try{let e=this.selectedAddressId;!e&&this.newAddress.recipientName&&this.newAddress.addressLine1&&(e=(yield this.api.createAddress(this.customer.id,P(O({},this.newAddress),{isShipping:!0,isBilling:!0,isDefault:!0}))).id);let d=this.cart.cartItems.map(l=>({variantId:l.productVariantId,quantity:l.quantity})),o=yield this.api.createCheckout({items:d,shippingAddressId:e||void 0,billingAddressId:e||void 0,couponCode:this.appliedCoupon?.code,customerNotes:this.customerNotes||void 0});o.url&&(window.location.href=o.url)}catch(e){this.error=e instanceof Error?e.message:this.translate.instant("CMS_CHECKOUT.ERROR")}finally{this.processing=!1}}})}loadData(){return S(this,null,function*(){try{this.customer=yield this.auth.getMe();let[e,d]=yield Promise.all([this.api.getCart(this.customer.id),this.api.getAddresses(this.customer.id)]);if(this.cart=e,this.addresses=d,d.length>0){let o=d.find(l=>l.isDefault)||d[0];this.selectedAddressId=o.id}}catch{this.cart=null}finally{this.loading=!1}})}static \u0275fac=function(d){return new(d||n)(E(F),E(D),E(K))};static \u0275cmp=U({type:n,selectors:[["app-checkout"]],decls:12,vars:4,consts:[[1,"min-h-screen","pt-28","pb-20",2,"background","var(--bg-primary)"],[1,"container-narrow"],[1,"flex","items-center","gap-3","mb-8"],["routerLink","/cart",1,"text-[var(--text-muted)]","hover:text-white","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-white"],[1,"space-y-6","animate-glow-pulse"],[1,"glass-card","rounded-2xl","p-12","text-center"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"glass-card","rounded-xl","p-6","h-48"],[1,"glass-card","rounded-xl","p-6","h-32"],[1,"text-xl","font-semibold","text-white","mb-2"],[1,"text-[var(--text-secondary)]","mb-6"],["routerLink","/products",1,"btn-primary","inline-block","px-6","py-3","rounded-xl"],[1,"lg:col-span-2","space-y-6"],[1,"glass-card","rounded-xl","p-6"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"space-y-3"],[1,"space-y-4"],[1,"flex","gap-3"],["type","text","name","coupon","placeholder","Inserisci codice",1,"flex-1","input-glass",3,"ngModelChange","ngModel"],[1,"btn-secondary","px-5","py-2.5","rounded-xl","font-medium","disabled:opacity-40","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-sm","text-red-400","mt-2"],[1,"mt-3","flex","items-center","justify-between","glass","border","border-emerald-500/20","rounded-xl","px-4","py-2.5"],["name","notes","rows","3","placeholder","Istruzioni speciali per la consegna...",1,"w-full","input-glass","resize-none",3,"ngModelChange","ngModel"],[1,"lg:col-span-1"],[1,"glass-card","rounded-xl","p-6","sticky","top-28"],[1,"space-y-3","mb-4"],[1,"flex","justify-between","text-sm"],[1,"border-t","border-white/[0.06]","pt-3","space-y-2","text-sm"],[1,"flex","justify-between","text-[var(--text-secondary)]"],[1,"text-white"],[1,"flex","justify-between","text-emerald-400"],[1,"text-emerald-400","font-medium"],[1,"border-t","border-white/[0.06]","pt-3","flex","justify-between","font-semibold","text-white","text-base"],[1,"mt-4","glass","border","border-red-500/20","text-red-400","px-4","py-3","rounded-xl","text-sm"],[1,"mt-6","w-full","btn-primary","py-4","px-6","rounded-xl","font-semibold","text-base","flex","items-center","justify-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[3,"class"],["type","radio","name","address",1,"mt-1","w-4","h-4","accent-[var(--accent-cyan)]",3,"ngModelChange","value","ngModel"],[1,"font-medium","text-white"],[1,"text-sm","text-[var(--text-secondary)]"],[1,"text-sm","text-[var(--text-secondary)]","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"sm:col-span-2"],[1,"block","text-sm","font-medium","text-[var(--text-secondary)]","mb-1"],["type","text","name","recipientName","placeholder","Mario Rossi",1,"w-full","input-glass",3,"ngModelChange","ngModel"],["type","text","name","addressLine1","placeholder","Via Roma 1",1,"w-full","input-glass",3,"ngModelChange","ngModel"],["type","text","name","city","placeholder","Roma",1,"w-full","input-glass",3,"ngModelChange","ngModel"],["type","text","name","postalCode","placeholder","00100",1,"w-full","input-glass",3,"ngModelChange","ngModel"],["type","text","name","stateProvince","placeholder","RM",1,"w-full","input-glass",3,"ngModelChange","ngModel"],["type","text","name","countryCode","value","IT","placeholder","IT",1,"w-full","input-glass",3,"ngModelChange","ngModel"],[1,"text-sm","text-emerald-400","font-medium"],[1,"text-emerald-400","hover:text-emerald-300","text-sm","font-medium",3,"click"],[1,"text-[var(--text-secondary)]","truncate","mr-2"],[1,"text-[var(--text-muted)]"],[1,"text-white","font-medium","whitespace-nowrap"],["viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4","fill","none",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(d,o){d&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),b(),a(4,"svg",4),T(5,"path",5),i()(),B(),a(6,"h1",6),r(7),s(8,"translate"),i()(),g(9,Q,3,0,"div",7)(10,X,10,9,"div",8)(11,ue,56,37,"div",9),i()()),d&2&&(t(7),c(p(8,2,"CMS_CHECKOUT.TITLE")),t(2),h(o.loading?9:!o.cart||o.cart.cartItems.length===0?10:11))},dependencies:[L,N,z,j,G,Y,q,R,W],encapsulation:2})}return n})();export{ye as CheckoutComponent};
